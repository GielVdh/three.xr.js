!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WebXRUtils=t.WebXRManager=void 0;var i=n(1),a=r(i),o=n(2),s=r(o);n(3),t.WebXRManager=a.default,t.WebXRUtils=s.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRManager=function(){function e(e){if(this.sessionActive){this.session.requestFrame(u);var t=e.getDisplayPose(e.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL));if(0===t._orientation[0]&&0===t._orientation[1]&&0===t._orientation[2]&&1===t._orientation[3]?this.poseFound&&(this.dispatchEvent({type:"poseLost"}),this.poseFound=!1):this.poseFound||(this.dispatchEvent({type:"poseFound"}),this.poseFound=!0),this.updateScene(o,e),this.renderer.autoClear=!1,this.renderer.setSize(this.session.baseLayer.framebufferWidth,this.session.baseLayer.framebufferHeight,!1),this.renderer.clear(),this.poseTarget.matrixAutoUpdate=!1,this.poseTarget.matrix.fromArray(t.poseModelMatrix),this.poseTarget.matrix.decompose(this.poseTarget.position,this.poseTarget.quaternion,this.poseTarget.scale),this.poseTarget.updateMatrixWorld(!0),this.sessionActive)for(var n=0;n<e.views.length;n++){var r=e.views[n];this.camera.matrixWorldInverse.fromArray(r.viewMatrix),this.camera.projectionMatrix.fromArray(r.projectionMatrix),this.renderer.clearDepth();var i=r.getViewport(this.session.baseLayer);this.renderer.setViewport(i.x,i.y,i.width,i.height),this.doRender()}else this.renderer.clearDepth(),this.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),this.doRender()}}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],s={AR_AUTOSTART:!0};this.options=Object.assign({},s,t),this.displays=n,this.renderer=r,this.camera=i,this.scene=a;var u=e.bind(this);this.sessions=[],this.session=null,this.autoStarted=!1,this.poseFound=!1,this.startSession=function(e,t,n){var i=this,a=!1;"vr"===t&&(a=!0);var o={exclusive:a,type:a?XRSession.REALITY:XRSession.AUGMENTATION};if(!this.sessionActive){null!==this.session&&(this.session.end(),this.session=null);var s=this;e.requestSession(o).then(function(e){i.session=e,e.realityType=t,e.depthNear=.05,e.depthFar=1e3,i.domElementOriginal=r.domElement.parentNode,i.cameraCloned=i.camera.clone(),i.camera.parent&&"Scene"!==i.camera.parent.type?i.poseTarget=i.camera.parent:i.poseTarget=i.camera,i.poseTargetCloned=i.poseTarget.clone(),e.addEventListener("focus",function(e){i.handleSessionFocus(e)}),e.addEventListener("blur",function(e){i.handleSessionBlur(e)}),e.addEventListener("end",function(e){i.handleSessionEnded(e)}),r.domElement.style.width="100%",r.domElement.style.height="100%","ar"===t&&n&&s.startPresenting()}).catch(function(e){console.error("Error requesting session",e)})}},this.startPresenting=function(){var e=this;c&&c._vrDisplay?(r.vr.enabled=!0,c._vrDisplay.isPresenting?c._vrDisplay.exitPresent():c._vrDisplay.requestPresent([{source:this.renderer.domElement}])):(this.session.baseLayer=new XRWebGLLayer(this.session,r.context),this.session.baseLayer.addEventListener("focus",function(t){e.handleLayerFocus(t)}),this.session.baseLayer.addEventListener("blur",function(t){e.handleLayerBlur(t)}),this.session.requestFrame(u),this.sessions.push(this.session),this.sessionActive=!0),document.getElementsByClassName("webxr-sessions")[0]&&(document.getElementsByClassName("webxr-sessions")[0].style.display="block"),this.dispatchEvent({type:"sessionStarted",session:this.session})},this.endSession=function(){this.session.end(),this.dispatchEvent({type:"sessionEnded",session:this.session}),this.sessionActive=!1,this.session._display._vrDisplay&&this.session._display.isPresenting&&(r.vr.enabled=!1,this.session._display._vrDisplay.exitPresent()),this.domElementOriginal.appendChild(this.session.baseLayer._context.canvas),this.poseTarget.matrixAutoUpdate=!1,this.poseTarget.matrix.copy(this.poseTargetCloned.matrix),this.poseTarget.updateMatrixWorld(!0),this.camera.matrixWorldInverse.copy(this.cameraCloned.matrixWorldInverse),this.camera.projectionMatrix.copy(this.cameraCloned.projectionMatrix),this.camera.updateProjectionMatrix(),document.getElementsByClassName("webxr-sessions")[0].style.display="none"},this.handleSessionFocus=function(e){console.log("handleSessionFocus")},this.handleSessionBlur=function(e){console.log("handleSessionBlur")},this.handleSessionEnded=function(e){console.log("handleSessionEnded")},this.handleLayerFocus=function(e){console.log("handleLayerFocus")},this.handleLayerBlur=function(e){console.log("handleLayerBlur")};var l,c,h=0,f=0;this.totalSupportedDisplays=0;for(var d=0;d<this.displays.length;d++){var _=this.displays[d];_.supportedRealities.vr&&(c=_,this.renderer.vr.setDevice(c._vrDisplay),h++),_.supportedRealities.ar&&(l=_,f++)}1===f&&0===h&&this.options.AR_AUTOSTART&&(this.autoStarted=!0,this.startSession(l,"ar",!0)),0===f&&1===h&&this.startSession(c,"vr",!1),this.totalSupportedDisplays=f+h,this.updateScene=function(e,t){e(t)},this.doRender=function(){this.renderer.render(this.scene,this.camera)}},THREE.WebXRManager.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.WebXRManager.prototype.constructor=THREE.WebXRManager,t.default=THREE.WebXRManager},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRUtils={getDisplays:function(){return new Promise(function(e,t){navigator.XR?navigator.XR.getDisplays().then(function(t){function n(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}if(0===t.length)return console.log("No displays are available"),void e(null);var r={exclusive:!1,type:XRSession.AUGMENTATION},i={exclusive:!0,type:XRSession.REALITY},a={vr:!1,ar:!1},o=!0,s=!1,u=void 0;try{for(var l,c=t[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;a={vr:!1,ar:!1},h.supportsSession(r)&&((h._reality._vrDisplay||!n()||function(){return-1!==navigator.userAgent.indexOf("AppleWebKit")&&-1===navigator.userAgent.indexOf("Safari")}())&&n()?a.ar=!0:a.ar=!1),h.supportsSession(i)&&-1===h._displayName.indexOf("polyfill")&&(a.vr=!0),h.supportedRealities=a}}catch(e){s=!0,u=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}e(t)}).catch(function(t){console.error("Error getting XR displays",t),e(null)}):(console.log("WebXR polyfill is not found"),e(null))})}},t.default=THREE.WebXRUtils},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void 0!==navigator.xr&&("undefined"!=typeof XRDisplay&&(XRDisplay=null),"undefined"!=typeof XRSession&&(XRSession=null),"undefined"!=typeof XRSessionCreateParameters&&(XRSessionCreateParameters=null),"undefined"!=typeof Reality&&(Reality=null),"undefined"!=typeof XRPointCloud&&(XRPointCloud=null),"undefined"!=typeof XRLightEstimate&&(XRLightEstimate=null),"undefined"!=typeof XRAnchor&&(XRAnchor=null),"undefined"!=typeof XRPlaneAnchor&&(XRPlaneAnchor=null),"undefined"!=typeof XRFaceAnchor&&(XRFaceAnchor=null),"undefined"!=typeof XRImageAnchor&&(XRImageAnchor=null),"undefined"!=typeof XRAnchorOffset&&(XRAnchorOffset=null),"undefined"!=typeof XRStageBounds&&(XRStageBounds=null),"undefined"!=typeof XRStageBoundsPoint&&(XRStageBoundsPoint=null),"undefined"!=typeof XRPresentationFrame&&(XRPresentationFrame=null),"undefined"!=typeof XRView&&(XRView=null),"undefined"!=typeof XRViewport&&(XRViewport=null),"undefined"!=typeof XRCoordinateSystem&&(XRCoordinateSystem=null),"undefined"!=typeof XRViewPose&&(XRViewPose=null),"undefined"!=typeof XRLayer&&(XRLayer=null),"undefined"!=typeof XRWebGLLayer&&(XRWebGLLayer=null),"undefined"!=typeof XRVideoFrame&&(XRVideoFrame=null)),function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=25)}([function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){r(this,e)}return i(e,null,[{key:"mat4_generateIdentity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"mat4_get_position",value:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}},{key:"mat4_get_rotation",value:function(e,t){var n=new o.default;return n.setFromRotationMatrix(t),e[0]=n.x,e[1]=n.y,e[2]=n.z,e[3]=n.w,e}},{key:"mat4_eyeView",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array([0,0,0]);e.mat4_translate(t,n,r),e.mat4_invert(t,t)}},{key:"mat4_perspectiveFromFieldOfView",value:function(t,n,r,i){var a=Math.tan(n.upDegrees*e.PI_OVER_180),o=Math.tan(n.downDegrees*e.PI_OVER_180),s=Math.tan(n.leftDegrees*e.PI_OVER_180),u=Math.tan(n.rightDegrees*e.PI_OVER_180),l=2/(s+u),c=2/(a+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-u)*l*.5,t[9]=(a-o)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}},{key:"mat4_fromRotationTranslation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,d=i*u,_=i*l,v=a*l,p=o*s,y=o*u,m=o*l;return e[0]=1-(d+v),e[1]=h+m,e[2]=f-y,e[3]=0,e[4]=h-m,e[5]=1-(c+v),e[6]=_+p,e[7]=0,e[8]=f+y,e[9]=_-p,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}},{key:"mat4_translate",value:function(e,t,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],l=t[3],c=t[4],h=t[5],f=t[6],d=t[7],_=t[8],v=t[9],p=t[10],y=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=h,e[6]=f,e[7]=d,e[8]=_,e[9]=v,e[10]=p,e[11]=y,e[12]=o*r+c*i+_*a+t[12],e[13]=s*r+h*i+v*a+t[13],e[14]=u*r+f*i+p*a+t[14],e[15]=l*r+d*i+y*a+t[15]),e}},{key:"mat4_invert",value:function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=n*s-r*o,E=n*u-i*o,w=n*l-a*o,b=r*u-i*s,g=r*l-a*s,R=i*l-a*u,M=c*v-h*_,A=c*p-f*_,T=c*y-d*_,O=h*p-f*v,P=h*y-d*v,x=f*y-d*p,I=m*x-E*P+w*O+b*T-g*A+R*M;return I?(I=1/I,e[0]=(s*x-u*P+l*O)*I,e[1]=(i*P-r*x-a*O)*I,e[2]=(v*R-p*g+y*b)*I,e[3]=(f*g-h*R-d*b)*I,e[4]=(u*T-o*x-l*A)*I,e[5]=(n*x-i*T+a*A)*I,e[6]=(p*w-_*R-y*E)*I,e[7]=(c*R-f*w+d*E)*I,e[8]=(o*P-s*T+l*M)*I,e[9]=(r*T-n*P-a*M)*I,e[10]=(_*g-v*w+y*m)*I,e[11]=(h*w-c*g-d*m)*I,e[12]=(s*A-o*O-u*M)*I,e[13]=(n*O-r*A+i*M)*I,e[14]=(v*E-_*b-p*m)*I,e[15]=(c*b-h*E+f*m)*I,e):null}},{key:"mat4_multiply",value:function(e,t,n){var r=t[0],i=t[4],a=t[8],o=t[12],s=t[1],u=t[5],l=t[9],c=t[13],h=t[2],f=t[6],d=t[10],_=t[14],v=t[3],p=t[7],y=t[11],m=t[15],E=n[0],w=n[4],b=n[8],g=n[12],R=n[1],M=n[5],A=n[9],T=n[13],O=n[2],P=n[6],x=n[10],I=n[14],S=n[3],N=n[7],k=n[11],C=n[15];return e[0]=r*E+i*R+a*O+o*S,e[4]=r*w+i*M+a*P+o*N,e[8]=r*b+i*A+a*x+o*k,e[12]=r*g+i*T+a*I+o*C,e[1]=s*E+u*R+l*O+c*S,e[5]=s*w+u*M+l*P+c*N,e[9]=s*b+u*A+l*x+c*k,e[13]=s*g+u*T+l*I+c*C,e[2]=h*E+f*R+d*O+_*S,e[6]=h*w+f*M+d*P+_*N,e[10]=h*b+f*A+d*x+_*k,e[14]=h*g+f*T+d*I+_*C,e[3]=v*E+p*R+y*O+m*S,e[7]=v*w+p*M+y*P+m*N,e[11]=v*b+p*A+y*x+m*k,e[15]=v*g+p*T+y*I+m*C,e}}]),e}();t.default=s,s.PI_OVER_180=Math.PI/180},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),this._uid=n||e._generateUID(),this._coordinateSystem=t}return i(e,[{key:"uid",get:function(){return this._uid}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}}],[{key:"_generateUID",value:function(){return"anchor-"+(new Date).getTime()+"-"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r(this,e),this.x=t,this.y=n,this.z=i,this.w=a}return i(e,[{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"setFromRotationMatrix",value:function(e){var t=e[0],n=e[4],r=e[8],i=e[1],a=e[5],o=e[9],s=e[2],u=e[6],l=e[10],c=t+a+l;if(c>0){var h=.5/Math.sqrt(c+1);this.w=.25/h,this.x=(u-o)*h,this.y=(r-s)*h,this.z=(i-n)*h}else if(t>a&&t>l){var h=2*Math.sqrt(1+t-a-l);this.w=(u-o)/h,this.x=.25*h,this.y=(n+i)/h,this.z=(r+s)/h}else if(a>l){var h=2*Math.sqrt(1+a-t-l);this.w=(r-s)/h,this.x=(n+i)/h,this.y=.25*h,this.z=(o+u)/h}else{var h=2*Math.sqrt(1+l-t-a);this.w=(i-n)/h,this.x=(r+s)/h,this.y=(o+u)/h,this.z=.25*h}return this}},{key:"setFromEuler",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",i=Math.cos,a=Math.sin,o=i(e/2),s=i(t/2),u=i(n/2),l=a(e/2),c=a(t/2),h=a(n/2);"XYZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"YXZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"ZXY"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"ZYX"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"YZX"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u-l*c*h):"XZY"===r&&(this.x=l*s*u-o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u+l*c*h)}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=e.w,o=t.x,s=t.y,u=t.z,l=t.w;return this.x=n*l+a*o+r*u-i*s,this.y=r*l+a*s+i*o-n*u,this.z=i*l+a*u+n*s-r*o,this.w=a*l-n*o-r*s-i*u,this}},{key:"inverse",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this.x,r=this.y,i=this.z,a=this.w,o=a*e.w+n*e.x+r*e.y+i*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=a,this.x=n,this.y=r,this.z=i,this;var s=Math.acos(o),u=Math.sqrt(1-o*o);if(Math.abs(u)<.001)return this.w=.5*(a+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var l=Math.sin((1-t)*s)/u,c=Math.sin(t*s)/u;return this.w=a*l+this.w*c,this.x=n*l+this.x*c,this.y=r*l+this.y*c,this.z=i*l+this.z*c,this}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._listeners=new Map}return i(e,[{key:"addEventListener",value:function(e,t){var n=this._listeners.get(e);!1===Array.isArray(n)&&(n=[],this._listeners.set(e,n)),n.push(t)}},{key:"removeEventListener",value:function(e,t){var n=this._listeners.get(e);if(!1!==Array.isArray(n))for(var r=0;r<n.length;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=this._listeners.get(e.type);if(!1!==Array.isArray(t)){var n=t.slice(0),r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){(0,o.value)(e)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}}}}]),e}();t.default=a},function(e,t,n){function r(e){t.ARRAY_TYPE=s=e}function i(e){return e*u}function a(e,t){return Math.abs(e-t)<=o*Math.max(1,Math.abs(e),Math.abs(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=r,t.toRadian=i,t.equals=a;var o=t.EPSILON=1e-6,s=t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,u=(t.RANDOM=Math.random,Math.PI/180)},function(e,t,n){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=n(3),f=a(h),d=n(4),_=(i(d),n(17)),v=i(_),p=n(18),y=i(p),m=n(12),E=i(m),w=n(19),b=a(w),g=n(2),R=(a(g),n(0)),M=a(R),A=function(e){function t(){function e(){return this.modelMatrix=new Float32Array(16),this}o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!1===t.HasARKit())throw"ARKitWrapper will only work in Mozilla's ARDemo test app";if(void 0!==t.GLOBAL_INSTANCE)throw"ARKitWrapper is a singleton. Use ARKitWrapper.GetOrCreate() to get the global instance.";n._deviceId=null,n._isWatching=!1,n._isInitialized=!1,n._rawARData=null,n.lightIntensity=1e3,n.projectionMatrix_=new Float32Array(16),n.viewMatrix_=new Float32Array(16),n.planes_=new Map,n.anchors_=new Map,n._timeOffsets=[],n._timeOffset=0,n._timeOffsetComputed=!1,n.timestamp=0,n._globalCallbacksMap={};for(var r=["onInit","onWatch"],i=0;i<r.length;i++)n._generateGlobalCallback(r[i],i);n._defaultOptions={location:!0,camera:!0,objects:!0,light_intensity:!0,computer_vision_data:!1},n._m90=v.fromZRotation(v.create(),90*M.default.PI_OVER_180),n._m90neg=v.fromZRotation(v.create(),-90*M.default.PI_OVER_180),n._m180=v.fromZRotation(v.create(),180*M.default.PI_OVER_180),n._mTemp=v.create();for(var a=[["arkitStartRecording",t.RECORD_START_EVENT],["arkitStopRecording",t.RECORD_STOP_EVENT],["arkitDidMoveBackground",t.DID_MOVE_BACKGROUND_EVENT],["arkitWillEnterForeground",t.WILL_ENTER_FOREGROUND_EVENT],["arkitInterrupted",t.INTERRUPTED_EVENT],["arkitInterruptionEnded",t.INTERRUPTION_ENDED_EVENT],["arkitShowDebug",t.SHOW_DEBUG_EVENT],["arkitWindowResize",t.WINDOW_RESIZE_EVENT],["onError",t.ON_ERROR],["arTrackingChanged",t.AR_TRACKING_CHANGED],["userGrantedComputerVisionData",t.USER_GRANTED_COMPUTER_VISION_DATA],["userGrantedWorldSensingData",t.USER_GRANTED_WORLD_SENSING_DATA]],u=0;u<a.length;u++)!function(e){window[a[e][0]]=function(t){t=t||null;try{n.dispatchEvent(new CustomEvent(a[e][1],{source:n,detail:t}))}catch(t){console.error(a[e][0]+" callback error",t)}}}(u);window.onComputerVisionData=function(e){n._onComputerVisionData(e)},window.setNativeTime=function(e){n._timeOffsets.push((performance||Date).now()-e.nativeTime),n._timeOffsetComputed=!0,n._timeOffset=0;for(var t=0;t<n._timeOffsets.length;t++)n._timeOffset+=n._timeOffsets[t];n._timeOffset=n._timeOffset/n._timeOffsets.length,console.log("Native time: "+e.nativeTime+", new timeOffset: "+n._timeOffset)},n._adjustARKitTime=function(e){return this._timeOffsetComputed?e+this._timeOffset:(performance||Date).now()};var l=n;return n.getPlanes=function(){return Array.from(this.planes_.values())},n.hitTestNoAnchor=function(){var t={rayStart:E.create(),rayEnd:E.create(),cameraPosition:E.create(),cameraQuaternion:y.create(),modelViewMatrix:v.create(),projectionMatrix:v.create(),projViewMatrix:v.create(),worldRayStart:E.create(),worldRayEnd:E.create(),worldRayDir:E.create(),planeMatrix:v.create(),planeExtent:E.create(),planePosition:E.create(),planeCenter:E.create(),planeNormal:E.create(),planeIntersection:E.create(),planeIntersectionLocal:E.create(),planeHit:v.create(),planeQuaternion:y.create()},n=function(e,t){v.set(e,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},r=function(){var e=E.create();return function(t,n,r,i){var a=E.dot(t,i);return E.subtract(e,n,r),E.dot(e,t)/a}}(),i=function(e,r){n(t.planeMatrix,e.modelMatrix),v.getTranslation(t.planeIntersection,t.planeMatrix);var i=E.distance(t.planeIntersection,t.cameraPosition);return n(t.planeMatrix,r.modelMatrix),v.getTranslation(t.planeIntersection,t.planeMatrix),i<E.distance(t.planeIntersection,t.cameraPosition)?-1:1};return function(a,o){if(a<0||a>1||o<0||o>1)throw new Error("hitTest - x and y values must be normalized [0,1]!");var s=[],u=this.getPlanes();if(!u||0==u.length)return s;E.set(t.rayStart,2*a-1,2*(1-o)-1,0),E.set(t.rayEnd,2*a-1,2*(1-o)-1,1),n(t.projectionMatrix,l.projectionMatrix_),n(t.modelViewMatrix,l.viewMatrix_),v.multiply(t.projViewMatrix,t.projectionMatrix,t.modelViewMatrix),v.invert(t.projViewMatrix,t.projViewMatrix),E.transformMat4(t.worldRayStart,t.rayStart,t.projViewMatrix),E.transformMat4(t.worldRayEnd,t.rayEnd,t.projViewMatrix),E.subtract(t.worldRayDir,t.worldRayEnd,t.worldRayStart),E.normalize(t.worldRayDir,t.worldRayDir);for(var c=0;c<u.length;c++){var h=u[c];n(t.planeMatrix,h.modelMatrix),E.set(t.planeCenter,h.center.x,h.center.y,h.center.z),E.transformMat4(t.planePosition,t.planeCenter,t.planeMatrix),t.planeAlignment=h.alignment,0===t.planeAlignment?E.set(t.planeNormal,0,1,0):E.set(t.planeNormal,t.planeMatrix[4],t.planeMatrix[5],t.planeMatrix[6]);var f=r(t.planeNormal,t.planePosition,t.worldRayStart,t.worldRayDir);if(!(f<0)){E.scale(t.planeIntersection,t.worldRayDir,f),E.add(t.planeIntersection,t.worldRayStart,t.planeIntersection),E.set(t.planeExtent,h.extent[0],0,h.extent[1]),v.getRotation(t.planeQuaternion,t.planeMatrix),v.invert(t.planeMatrix,t.planeMatrix),E.transformMat4(t.planeIntersectionLocal,t.planeIntersection,t.planeMatrix);if(!(Math.abs(t.planeIntersectionLocal[0])>t.planeExtent[0]/2+.0075||Math.abs(t.planeIntersectionLocal[2])>t.planeExtent[2]/2+.0075)){v.fromRotationTranslation(t.planeHit,t.planeQuaternion,t.planeIntersection);for(var d=new e,_=0;_<16;_++)d.modelMatrix[_]=t.planeHit[_];d.i=c,s.push(d)}}}return s.sort(i),s}}(),n}return u(t,e),c(t,[{key:"waitForInit",value:function(){var e=this;return new Promise(function(n,r){if(e._isInitialized)return void n();var i=function r(){e.removeEventListener(t.INIT_EVENT,r,!1),n()};e.addEventListener(t.INIT_EVENT,i,!1)})}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?this._rawARData:this._rawARData&&void 0!==this._rawARData[e]?this._rawARData[e]:null}},{key:"getObject",value:function(e){if(!this._isInitialized)return null;var t=this.getKey("objects");if(null===t)return null;var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(s.uuid===e)return s}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return null}},{key:"hitTest",value:function(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.HIT_TEST_TYPE_ALL;return new Promise(function(t,a){if(!r._isInitialized)return void a(new Error("ARKit is not initialized"));window.webkit.messageHandlers.hitTest.postMessage({x:e,y:n,type:i,callback:r._createPromiseCallback("hitTest",t)})})}},{key:"addAnchor",value:function(e,t){var n=this;return new Promise(function(r,i){if(!n._isInitialized)return void i(new Error("ARKit is not initialized"));window.webkit.messageHandlers.addAnchor.postMessage({uuid:e,transform:t,callback:n._createPromiseCallback("addAnchor",r)})})}},{key:"removeAnchor",value:function(e){window.webkit.messageHandlers.removeAnchors.postMessage([e])}},{key:"createImageAnchor",value:function(e,t,n,r,i){var a=this;return new Promise(function(o,s){if(!a._isInitialized)return void s(new Error("ARKit is not initialized"));var u=b.default.encode(t);window.webkit.messageHandlers.createImageAnchor.postMessage({uid:e,buffer:u,imageWidth:n,imageHeight:r,physicalWidth:i,callback:a._createPromiseCallback("createImageAnchor",o)})})}},{key:"activateDetectionImage",value:function(e){var t=this;return new Promise(function(n,r){if(!t._isInitialized)return void r(new Error("ARKit is not initialized"));window.webkit.messageHandlers.activateDetectionImage.postMessage({uid:e,callback:t._createPromiseCallback("activateDetectionImage",n)})})}},{key:"stop",value:function(){var e=this;return new Promise(function(t,n){if(!e._isWatching)return void t();console.log("----STOP"),window.webkit.messageHandlers.stopAR.postMessage({callback:e._createPromiseCallback("stop",t)})})}},{key:"watch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInitialized)return!1;if(this._isWatching)return!0;this._isWatching=!0;var t=Object.assign({},this._defaultOptions);null!=e&&(t=Object.assign(t,e)),t.videoFrames&&(delete t.videoFrames,t.computer_vision_data=!0);var n={options:t,callback:this._globalCallbacksMap.onWatch};return console.log("----WATCH"),window.webkit.messageHandlers.watchAR.postMessage(n),!0}},{key:"setUIOptions",value:function(e){window.webkit.messageHandlers.setUIOptions.postMessage(e)}},{key:"_sendInit",value:function(e){console.log("----INIT"),window.webkit.messageHandlers.initAR.postMessage({options:e,callback:this._globalCallbacksMap.onInit})}},{key:"_onInit",value:function(e){this._deviceId=e,this._isInitialized=!0;try{this.dispatchEvent(new CustomEvent(t.INIT_EVENT,{source:this}))}catch(e){console.error("INIT_EVENT event error",e)}}},{key:"_onWatch",value:function(e){this._rawARData=e;try{this.dispatchEvent(new CustomEvent(t.WATCH_EVENT,{source:this,detail:this._rawARData}))}catch(e){console.error("WATCH_EVENT event error",e)}if(this.timestamp=this._adjustARKitTime(e.timestamp),this.lightIntensity=e.light_intensity,this.viewMatrix_=e.camera_view,this.projectionMatrix_=e.projection_camera,e.newObjects.length)for(var n=0;n<e.newObjects.length;n++){var r=e.newObjects[n];r.plane_center?this.planes_.set(r.uuid,{id:r.uuid,center:r.plane_center,extent:[r.plane_extent.x,r.plane_extent.z],modelMatrix:r.transform,alignment:r.plane_alignment}):this.anchors_.set(r.uuid,{id:r.uuid,modelMatrix:r.transform})}if(e.removedObjects.length)for(var i=0;i<e.removedObjects.length;i++){var a=e.removedObjects[i];this.planes_.get(a)?this.planes_.delete(a):this.anchors_.delete(a)}if(e.objects.length)for(var o=0;o<e.objects.length;o++){var s=e.objects[o];if(s.plane_center){var u=this.planes_.get(s.uuid);u?(u.center=s.plane_center,u.extent[0]=s.plane_extent.x,u.extent[1]=s.plane_extent.y,u.modelMatrix=s.transform,u.alignment=s.plane_alignment):this.planes_.set(s.uuid,{id:s.uuid,center:s.plane_center,extent:[s.plane_extent.x,s.plane_extent.z],modelMatrix:s.transform,alignment:s.plane_alignment})}else{var l=this.anchors_.get(s.uuid);l?l.modelMatrix=s.transform:this.anchors_.set(s.uuid,{id:s.uuid,modelMatrix:s.transform})}}}},{key:"_onStop",value:function(){this._isWatching=!1}},{key:"_createPromiseCallback",value:function(e,t){var n=this,r=this._generateCallbackUID(e);return window[r]=function(i){delete window[r];var a="_on"+e[0].toUpperCase()+e.slice(1);"function"==typeof n[a]&&n[a](i),t(i)},r}},{key:"_generateCallbackUID",value:function(e){return"arkitCallback_"+e+"_"+(new Date).getTime()+"_"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}},{key:"_generateGlobalCallback",value:function(e,t){var n="arkitCallback"+t;this._globalCallbacksMap[e]=n;var r=this;window[n]=function(t){r["_"+e](t)}}},{key:"_onComputerVisionData",value:function(e){if(!e)return console.error("detail passed to _onComputerVisionData is null"),void this._requestComputerVisionData();if(!e.frame||!e.frame.buffers||e.frame.buffers.length<=0)return console.error("detail passed to _onComputerVisionData is bad, no buffers"),void this._requestComputerVisionData();e.camera.arCamera=!0;var n=e.camera.interfaceOrientation;switch(e.camera.viewMatrix=e.camera.inverse_viewMatrix,n){case 1:e.camera.cameraOrientation=-90;break;case 2:e.camera.cameraOrientation=90;break;case 3:e.camera.cameraOrientation=0;break;case 4:e.camera.cameraOrientation=180}switch(e.frame.pixelFormatType){case"kCVPixelFormatType_420YpCbCr8BiPlanarFullRange":e.frame.pixelFormat="YUV420P";break;default:e.frame.pixelFormat=e.frame.pixelFormatType}var r=new XRVideoFrame(e.frame.buffers,e.frame.pixelFormat,this._adjustARKitTime(e.frame.timestamp),e.camera);try{this.dispatchEvent(new CustomEvent(t.COMPUTER_VISION_DATA,{source:this,detail:r}))}catch(e){console.error("COMPUTER_VISION_DATA event error",e)}}},{key:"_requestComputerVisionData",value:function(){window.webkit.messageHandlers.requestComputerVisionData.postMessage({})}},{key:"_startSendingComputerVisionData",value:function(){window.webkit.messageHandlers.startSendingComputerVisionData.postMessage({})}},{key:"_stopSendingComputerVisionData",value:function(){window.webkit.messageHandlers.stopSendingComputerVisionData.postMessage({})}},{key:"deviceId",get:function(){return this._deviceId}},{key:"isWatching",get:function(){return this._isWatching}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"hasData",get:function(){return null!==this._rawARData}}],[{key:"GetOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===t.GLOBAL_INSTANCE){t.GLOBAL_INSTANCE=new t,e=e&&"object"==(void 0===e?"undefined":l(e))?e:{};var n={browser:!0,points:!0,focus:!1,rec:!0,rec_time:!0,mic:!1,build:!1,plane:!0,warnings:!0,anchors:!1,debug:!0,statistics:!1},r="object"==l(e.ui)?e.ui:{};e.ui=Object.assign(n,r),t.GLOBAL_INSTANCE._sendInit(e)}return t.GLOBAL_INSTANCE}},{key:"HasARKit",value:function(){return void 0!==window.webkit}}]),t}(f.default);t.default=A,A.INIT_EVENT="arkit-init",A.WATCH_EVENT="arkit-watch",A.RECORD_START_EVENT="arkit-record-start",A.RECORD_STOP_EVENT="arkit-record-stop",A.DID_MOVE_BACKGROUND_EVENT="arkit-did-move-background",A.WILL_ENTER_FOREGROUND_EVENT="arkit-will-enter-foreground",A.INTERRUPTED_EVENT="arkit-interrupted",A.INTERRUPTION_ENDED_EVENT="arkit-interruption-ended",A.SHOW_DEBUG_EVENT="arkit-show-debug",A.WINDOW_RESIZE_EVENT="arkit-window-resize",A.ON_ERROR="on-error",A.AR_TRACKING_CHANGED="ar_tracking_changed",A.COMPUTER_VISION_DATA="cv_data",A.USER_GRANTED_COMPUTER_VISION_DATA="user-granted-cv-data",A.USER_GRANTED_WORLD_SENSING_DATA="user-granted-world-sensing-data",A.ORIENTATION_UP=1,A.ORIENTATION_UP_MIRRORED=2,A.ORIENTATION_DOWN=3,A.ORIENTATION_DOWN_MIRRORED=4,A.ORIENTATION_LEFT_MIRRORED=5,A.ORIENTATION_RIGHT=6,A.ORIENTATION_RIGHT_MIRRORED=7,A.ORIENTATION_LEFT=8,A.HIT_TEST_TYPE_FEATURE_POINT=1,A.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=2,A.HIT_TEST_TYPE_ESTIMATED_VERTICAL_PLANE=4,A.HIT_TEST_TYPE_EXISTING_PLANE=8,A.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=16,A.HIT_TEST_TYPE_EXISTING_PLANE_USING_GEOMETRY=32,A.HIT_TEST_TYPE_ALL=A.HIT_TEST_TYPE_FEATURE_POINT|A.HIT_TEST_TYPE_EXISTING_PLANE|A.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|A.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,A.HIT_TEST_TYPE_EXISTING_PLANES=A.HIT_TEST_TYPE_EXISTING_PLANE|A.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,A.ANCHOR_TYPE_PLANE="plane",A.ANCHOR_TYPE_FACE="face",A.ANCHOR_TYPE_ANCHOR="anchor",A.ANCHOR_TYPE_IMAGE="image"},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(0),c=i(l),h=n(3),f=i(h),d=n(26),_=i(d),v=n(16),p=i(v),y=n(7),m=(i(y),function(e){function t(e,n,r,i){a(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s._xr=e,s._displayName=n,s._isExternal=r,s._reality=i,s._headModelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.HEAD_MODEL),s._eyeLevelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.EYE_LEVEL),s._trackerCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.TRACKER),s._headPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._eyeLevelPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._trackerPoseModelMatrix=c.default.mat4_generateIdentity(),s._fovy=70;var u=s._fovy/2;return s._fov=new p.default(u,u,u,u),s._depthNear=.1,s._depthFar=1e3,s._views=[],s}return s(t,e),u(t,[{key:"supportsSession",value:function(e){return this._supportedCreationParameters(e)}},{key:"requestSession",value:function(e){var t=this;return new Promise(function(n,r){if(!1===t._supportedCreationParameters(e))return void r();e.type===XRSession.REALITY&&(t._reality=new _.default,t._xr._privateRealities.push(t._reality)),n(t._createSession(e))})}},{key:"_requestVideoFrame",value:function(){}},{key:"_requestAnimationFrame",value:function(e){return window.requestAnimationFrame(e)}},{key:"_cancelAnimationFrame",value:function(e){return window.cancelAnimationFrame(e)}},{key:"_createSession",value:function(e){return new XRSession(this._xr,this,e)}},{key:"_supportedCreationParameters",value:function(e){throw"Should be implemented by extending class"}},{key:"_handleNewFrame",value:function(e){}},{key:"_handleAfterFrame",value:function(e){}},{key:"_handleNewBaseLayer",value:function(e){}},{key:"displayName",get:function(){return this._displayName}},{key:"isExternal",get:function(){return this._isExternal}}]),t}(f.default));t.default=m,m.NEW_WORLD_ANCHOR="world-anchor",m.UPDATE_WORLD_ANCHOR="update-world-anchor",m.REMOVE_WORLD_ANCHOR="remove-world-anchor"},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n,r,o){i(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s._xr=e,s._name=n,s._isShared=r,s._isPassthrough=o,s._anchors=new Map,s}return o(t,e),s(t,[{key:"getCoordinateSystem",value:function(){throw new Error("Not implemented")}},{key:"_start",value:function(e){throw new Error("Exending classes should implement _start")}},{key:"_stop",value:function(){throw new Error("Exending classes should implement _stop")}},{key:"_requestVideoFrame",value:function(){}},{key:"_stopVideoFrames",value:function(){}},{key:"_startVideoFrames",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){throw new Error("Exending classes should implement _addAnchor")}},{key:"_findAnchor",value:function(e,t,n){throw new Error("Exending classes should implement _findAnchor")}},{key:"_createImageAnchor",value:function(e,t,n,r,i){throw new Error("Exending classes should implement _createImageAnchor")}},{key:"activateDetectionImage",value:function(e,t){throw new Error("Exending classes should implement _activateDetectionImage")}},{key:"_findFloorAnchor",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];throw new Error("Exending classes should implement _findFloorAnchor")}},{key:"_getAnchor",value:function(e){return this._anchors.get(e)||null}},{key:"_removeAnchor",value:function(e){throw new Error("Exending classes should implement _removeAnchor")}},{key:"_hitTestNoAnchor",value:function(e,t,n){throw new Error("Exending classes should implement _hitTestNoAnchor")}},{key:"_getLightAmbientIntensity",value:function(){throw new Error("Exending classes should implement _getLightAmbientIntensity")}},{key:"name",get:function(){return this._name}},{key:"isShared",get:function(){return this._isShared}},{key:"isPassthrough",get:function(){return this._isPassthrough}}]),t}(l.default);t.default=c,c.COMPUTER_VISION_DATA="cv_data",c.WINDOW_RESIZE_EVENT="window-resize",c.NEW_WORLD_ANCHOR="world-anchor",c.UPDATE_WORLD_ANCHOR="update-world-anchor",c.REMOVE_WORLD_ANCHOR="remove-world-anchor"},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments[2],o=arguments[3];i(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return s.geometry=r,s.blendShapes={},s.updateBlendShapes(o),s}return o(t,e),s(t,[{key:"updateBlendShapes",value:function(e){for(var t=0;t<h.length;t++)this.blendShapes[h[t]]=e[t]}}]),t}(l.default);t.default=c;var h=["browDownLeft","browDownRight","browInnerUp","browOuterUpLeft","browOuterUpRight","cheekPuff","cheekSquintLeft","cheekSquintRight","eyeBlinkLeft","eyeBlinkRight","eyeLookDownLeft","eyeLookDownRight","eyeLookInLeft","eyeLookInRight","eyeLookOutLeft","eyeLookOutRight","eyeLookUpLeft","eyeLookUpRight","eyeSquintLeft","eyeSquintRight","eyeWideLeft","eyeWideRight","jawForward","jawLeft","jawOpen","jawRight","mouthClose","mouthDimpleLeft","mouthDimpleRight","mouthFrownLeft","mouthFrownRight","mouthFunnel","mouthLeft","mouthLowerDownLeft","mouthLowerDownRight","mouthPressLeft","mouthPressRight","mouthPucker","mouthRight","mouthRollLower","mouthRollUpper","mouthShrugLower","mouthShrugUpper","mouthSmileLeft","mouthSmileRight","mouthStretchLeft","mouthStretchRight","mouthUpperUpLeft","mouthUpperUpRight","noseSneerLeft","noseSneerRight"]},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return o(t,e),t}(u.default);t.default=l},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments[2],o=arguments[3],s=arguments[4],u=arguments[5];i(this,t);var l=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return l.center=r,l.extent=o,l.alignment=s,l.geometry=u,l}return o(t,e),s(t,[{key:"width",get:function(){throw"Not implemented"}},{key:"length",get:function(){throw"Not implemented"}}]),t}(l.default);t.default=c},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(3),c=i(l),h=n(0),f=i(h),d=n(6),_=i(d),v=n(8),p=(i(v),n(9)),y=(i(p),n(1)),m=(i(y),n(5)),E=(i(m),n(10)),w=(i(E),function(e){function t(e,n,r){a(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._xr=e,i._display=n,i._createParameters=r,i._ended=!1,i._baseLayer=null,i._stageBounds=null,i._skip=!1,i._frameAnchors=[],i._tempMatrix=f.default.mat4_generateIdentity(),i._tempMatrix2=f.default.mat4_generateIdentity(),i._display.addEventListener(_.default.NEW_WORLD_ANCHOR,i._handleNewWorldAnchor.bind(i)),i._display.addEventListener(_.default.REMOVE_WORLD_ANCHOR,i._handleRemoveWorldAnchor.bind(i)),i._display.addEventListener(_.default.UPDATE_WORLD_ANCHOR,i._handleUpdateWorldAnchor.bind(i)),i}return s(t,e),u(t,[{key:"requestFrame",value:function(e){if(this._ended)return null;if("function"!=typeof e)throw"Invalid callback";return this._handleRequestFrame(e)}},{key:"_handleRequestFrame",value:function(e){var t=this;return this._display._requestAnimationFrame(function(n){if(t._skip)return t._skip=!1,t._handleRequestFrame(e);var r=t._createPresentationFrame(n);t._updateCameraAnchor(r),t._display._reality._handleNewFrame(r),t._display._handleNewFrame(r),e(r),t._display._handleAfterFrame(r)})}},{key:"cancelFrame",value:function(e){return this._display._cancelAnimationFrame(e)}},{key:"end",value:function(){if(!this._ended){for(var e=0;e<this._frameAnchors.length;e++)this._display._reality._removeAnchor(this._frameAnchors[e].uid);return this._frameAnchors=[],this._ended=!0,this._display._stop(),new Promise(function(e,t){e()})}}},{key:"_updateCameraAnchor",value:function(e){if(0==this._frameAnchors.length||this._frameAnchors[0].timestamp+6e4<e.timestamp){var t=e.getCoordinateSystem(XRCoordinateSystem.EYE_LEVEL),n=e.addAnchor(t,[0,-1,0]),r=e.getAnchor(n);if(r.timestamp=e.timestamp,this._frameAnchors.unshift(r),this._frameAnchors.length>10){var i=this._frameAnchors.pop();this._display._reality._removeAnchor(i.uid)}return r}return this._frameAnchors[0]}},{key:"_transformToCameraAnchor",value:function(e){if(0==this._frameAnchors.length)return e.viewMatrix;var t=e.viewMatrix;e._anchorUid=this._frameAnchors[0].uid;var n=this._frameAnchors[0].coordinateSystem;f.default.mat4_invert(this._tempMatrix,n._poseModelMatrix),f.default.mat4_multiply(e.viewMatrix,this._tempMatrix,t)}},{key:"setVideoFrameHandler",value:function(e){var t=this;if(e instanceof Worker){var n=e;e=function(e){t._transformToCameraAnchor(e.detail.camera),e.detail.postMessageToWorker(n,{type:"newVideoFrame"}),e.detail.release()}}else{var r=e;e=function(e){t._transformToCameraAnchor(e.detail.camera),r(e)}}this._display.addEventListener("videoFrame",e)}},{key:"getVideoFramePose",value:function(e,t){if(e.camera._anchorUid){var n,r=this.reality._getAnchor(e.camera._anchorUid);if(r)n=r.coordinateSystem._poseModelMatrix;else{for(var i=0;i<this._frameAnchors.length;i++)if(e.camera._anchorUid==this._frameAnchors[i].uid){n=this._frameAnchors[i].coordinateSystem._poseModelMatrix;break}if(i==this._frameAnchors.length)return void console.warn("should never get here: session.getVideoFramePose can't find anchor")}f.default.mat4_multiply(t,n,e.camera.viewMatrix)}}},{key:"hitTest",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.reality._findAnchor(e,t,this.display,n)}},{key:"requestVideoFrame",value:function(){this._display._requestVideoFrame()}},{key:"stopVideoFrames",value:function(){this._display._stopVideoFrames()}},{key:"startVideoFrames",value:function(){this._display._startVideoFrames()}},{key:"_createPresentationFrame",value:function(e){return new XRPresentationFrame(this,e)}},{key:"_getCoordinateSystem",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){switch(o.value){case XRCoordinateSystem.HEAD_MODEL:return this._display._headModelCoordinateSystem;case XRCoordinateSystem.EYE_LEVEL:return this._display._eyeLevelCoordinateSystem;case XRCoordinateSystem.TRACKER:return this._display._trackerCoordinateSystem;case XRCoordinateSystem.GEOSPATIAL:default:continue}}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return null}},{key:"createImageAnchor",value:function(e,t,n,r,i){return this.reality._createImageAnchor(e,t,n,r,i)}},{key:"activateDetectionImage",value:function(e){return this.reality._activateDetectionImage(e,this._display)}},{key:"_handleNewWorldAnchor",value:function(e){var n=e.detail;try{this.dispatchEvent(new CustomEvent(t.NEW_WORLD_ANCHOR,{source:this,detail:n}))}catch(e){console.error("NEW_WORLD_ANCHOR event error",e)}}},{key:"_handleUpdateWorldAnchor",value:function(e){var n=e.detail;try{this.dispatchEvent(new CustomEvent(t.UPDATE_WORLD_ANCHOR,{source:this,detail:n}))}catch(e){console.error("UPDATE_WORLD_ANCHOR event error",e)}}},{key:"_handleRemoveWorldAnchor",value:function(e){var n=e.detail;try{this.dispatchEvent(new CustomEvent(t.REMOVE_WORLD_ANCHOR,{source:this,detail:n}))}catch(e){console.error("REMOVE_WORLD_ANCHOR event error",e)}}},{key:"display",get:function(){return this._display}},{key:"createParameters",get:function(){return this._parameters}},{key:"realities",get:function(){return this._xr._sharedRealities}},{key:"reality",get:function(){return this._display._reality}},{key:"baseLayer",get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this._display._handleNewBaseLayer(this._baseLayer)}},{key:"depthNear",get:function(){this._display._depthNear},set:function(e){this._display._depthNear=e}},{key:"depthFar",get:function(){this._display._depthFar},set:function(e){this._display._depthFar=e}},{key:"hasStageBounds",get:function(){this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds}}]),t}(c.default));t.default=w,w.REALITY="reality",w.AUGMENTATION="augmentation",w.TYPES=[w.REALITY,w.AUGMENTATION],w.NEW_WORLD_ANCHOR="world-anchor",w.UPDATE_WORLD_ANCHOR="update-world-anchor",w.REMOVE_WORLD_ANCHOR="remove-world-anchor"},function(e,t,n){function r(){var e=new G.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function i(e){var t=new G.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function o(e,t,n){var r=new G.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=n,r}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function u(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function l(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function c(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function h(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function f(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function d(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function _(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function v(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function p(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function y(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function m(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function E(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function w(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function b(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function g(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function R(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function M(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function A(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function T(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function O(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}function P(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}function x(e,t,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function I(e,t,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,f=u*a;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*f,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*f,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*f,e}function S(e,t){t=t||1;var n=2*G.RANDOM()*Math.PI,r=2*G.RANDOM()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function N(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}function k(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function C(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,f=l*a+o*i-s*r,d=-o*r-s*i-u*a;return e[0]=c*l+d*-o+h*-u-f*-s,e[1]=h*l+d*-s+f*-o-c*-u,e[2]=f*l+d*-u+c*-s-h*-o,e}function L(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function D(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function F(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function V(e,t){var n=o(e[0],e[1],e[2]),r=o(t[0],t[1],t[2]);A(n,n),A(r,r);var i=T(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function X(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function W(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function j(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(n-a)<=G.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=G.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=G.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=r,t.clone=i,t.length=a,t.fromValues=o,t.copy=s,t.set=u,t.add=l,t.subtract=c,t.multiply=h,t.divide=f,t.ceil=d,t.floor=_,t.min=v,t.max=p,t.round=y,t.scale=m,t.scaleAndAdd=E,t.distance=w,t.squaredDistance=b,t.squaredLength=g,t.negate=R,t.inverse=M,t.normalize=A,t.dot=T,t.cross=O,t.lerp=P,t.hermite=x,t.bezier=I,t.random=S,t.transformMat4=N,t.transformMat3=k,t.transformQuat=C,t.rotateX=L,t.rotateY=D,t.rotateZ=F,t.angle=V,t.str=X,t.exactEquals=W,t.equals=j;var H=n(4),G=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(H);t.sub=c,t.mul=h,t.div=f,t.dist=w,t.sqrDist=b,t.len=a,t.sqrLen=g,t.forEach=function(){var e=r();return function(t,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(22),s=r(o),u=n(0),l=r(u),c=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this._fov=t,this._depthNear=n,this._depthFar=r,this._eye=a,this._viewport=new s.default(0,0,1,1),this._projectionMatrix=new Float32Array(16),this._viewMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}return a(e,[{key:"setProjectionMatrix",value:function(e){for(var t=0;t<16;t++)this._projectionMatrix[t]=e[t]}},{key:"setViewMatrix",value:function(e){for(var t=0;t<16;t++)this._viewMatrix[t]=e[t]}},{key:"getViewport",value:function(t){return this._eye===e.LEFT?(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):this._eye===e.RIGHT?(this._viewport.x=t.framebufferWidth/2,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth,this._viewport.height=t.framebufferHeight),this._viewport}},{key:"fov",set:function(e){this._fov=e,l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}},{key:"eye",get:function(){return this._eye}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}},{key:"viewMatrix",get:function(){return this._viewMatrix}}]),e}();t.default=c,c.LEFT="left",c.RIGHT="right",c.EYES=[c.LEFT,c.RIGHT]},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),s=r(o),u=n(2),l=r(u),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];i(this,e),this._poseModelMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseModelMatrix,n,t)}return a(e,[{key:"_setPoseModelMatrix",value:function(e){for(var t=0;t<16;t++)this._poseModelMatrix[t]=e[t]}},{key:"_translate",value:function(e){this._poseModelMatrix[12]+=e[0],this._poseModelMatrix[13]+=e[1],this._poseModelMatrix[14]+=e[2]}},{key:"getViewMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=new Float32Array(16)),s.default.mat4_eyeView(t,this._poseModelMatrix),t}},{key:"poseModelMatrix",get:function(){return this._poseModelMatrix}},{key:"_position",get:function(){return[this._poseModelMatrix[12],this._poseModelMatrix[13],this._poseModelMatrix[14]]},set:function(e){this._poseModelMatrix[12]=e[0],this._poseModelMatrix[13]=e[1],this._poseModelMatrix[14]=e[2]}},{key:"_orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseModelMatrix),e.toArray()},set:function(e){s.default.mat4_fromRotationTranslation(this._poseModelMatrix,e,this._position)}}]),e}();t.default=c,c.SITTING_EYE_HEIGHT=0},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,e),this.x=t,this.y=n,this.z=i}return i(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"add",value:function(e,t,n){this.x+=e,this.y+=t,this.z+=n}},{key:"normalize",value:function(){var e=this.length();return 0!==e?this.multiplyScalar(1/e):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyScalar",value:function(e){this.x*=e,this.y*=e,this.z*=e}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,l=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,i,a){r(this,e),this._upDegrees=t,this._downDegrees=n,this._leftDegrees=i,this._rightDegrees=a}return i(e,[{key:"upDegrees",get:function(){return this._upDegrees}},{key:"downDegrees",get:function(){return this._downDegrees}},{key:"leftDegrees",get:function(){return this._leftDegrees}},{key:"rightDegrees",get:function(){return this._rightDegrees}}]),e}();t.default=a},function(e,t,n){function r(){var e=new K.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i(e){var t=new K.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,n,r,i,a,o,s,u,l,c,h,f,d,_,v){var p=new K.ARRAY_TYPE(16);return p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=i,p[5]=a,p[6]=o,p[7]=s,p[8]=u,p[9]=l,p[10]=c,p[11]=h,p[12]=f,p[13]=d,p[14]=_,p[15]=v,p}function s(e,t,n,r,i,a,o,s,u,l,c,h,f,d,_,v,p){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=f,e[12]=d,e[13]=_,e[14]=v,e[15]=p,e}function u(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function c(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=n*s-r*o,E=n*u-i*o,w=n*l-a*o,b=r*u-i*s,g=r*l-a*s,R=i*l-a*u,M=c*v-h*_,A=c*p-f*_,T=c*y-d*_,O=h*p-f*v,P=h*y-d*v,x=f*y-d*p,I=m*x-E*P+w*O+b*T-g*A+R*M;return I?(I=1/I,e[0]=(s*x-u*P+l*O)*I,e[1]=(i*P-r*x-a*O)*I,e[2]=(v*R-p*g+y*b)*I,e[3]=(f*g-h*R-d*b)*I,e[4]=(u*T-o*x-l*A)*I,e[5]=(n*x-i*T+a*A)*I,e[6]=(p*w-_*R-y*E)*I,e[7]=(c*R-f*w+d*E)*I,e[8]=(o*P-s*T+l*M)*I,e[9]=(r*T-n*P-a*M)*I,e[10]=(_*g-v*w+y*m)*I,e[11]=(h*w-c*g-d*m)*I,e[12]=(s*A-o*O-u*M)*I,e[13]=(n*O-r*A+i*M)*I,e[14]=(v*E-_*b-p*m)*I,e[15]=(c*b-h*E+f*m)*I,e):null}function h(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15];return e[0]=s*(f*y-d*p)-h*(u*y-l*p)+v*(u*d-l*f),e[1]=-(r*(f*y-d*p)-h*(i*y-a*p)+v*(i*d-a*f)),e[2]=r*(u*y-l*p)-s*(i*y-a*p)+v*(i*l-a*u),e[3]=-(r*(u*d-l*f)-s*(i*d-a*f)+h*(i*l-a*u)),e[4]=-(o*(f*y-d*p)-c*(u*y-l*p)+_*(u*d-l*f)),e[5]=n*(f*y-d*p)-c*(i*y-a*p)+_*(i*d-a*f),e[6]=-(n*(u*y-l*p)-o*(i*y-a*p)+_*(i*l-a*u)),e[7]=n*(u*d-l*f)-o*(i*d-a*f)+c*(i*l-a*u),e[8]=o*(h*y-d*v)-c*(s*y-l*v)+_*(s*d-l*h),e[9]=-(n*(h*y-d*v)-c*(r*y-a*v)+_*(r*d-a*h)),e[10]=n*(s*y-l*v)-o*(r*y-a*v)+_*(r*l-a*s),e[11]=-(n*(s*d-l*h)-o*(r*d-a*h)+c*(r*l-a*s)),e[12]=-(o*(h*p-f*v)-c*(s*p-u*v)+_*(s*f-u*h)),e[13]=n*(h*p-f*v)-c*(r*p-i*v)+_*(r*f-i*h),e[14]=-(n*(s*p-u*v)-o*(r*p-i*v)+_*(r*u-i*s)),e[15]=n*(s*f-u*h)-o*(r*f-i*h)+c*(r*u-i*s),e}function f(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],d=e[12],_=e[13],v=e[14],p=e[15];return(t*o-n*a)*(h*p-f*v)-(t*s-r*a)*(c*p-f*_)+(t*u-i*a)*(c*v-h*_)+(n*s-r*o)*(l*p-f*d)-(n*u-i*o)*(l*v-h*d)+(r*u-i*s)*(l*_-c*d)}function d(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],_=t[11],v=t[12],p=t[13],y=t[14],m=t[15],E=n[0],w=n[1],b=n[2],g=n[3];return e[0]=E*r+w*s+b*h+g*v,e[1]=E*i+w*u+b*f+g*p,e[2]=E*a+w*l+b*d+g*y,e[3]=E*o+w*c+b*_+g*m,E=n[4],w=n[5],b=n[6],g=n[7],e[4]=E*r+w*s+b*h+g*v,e[5]=E*i+w*u+b*f+g*p,e[6]=E*a+w*l+b*d+g*y,e[7]=E*o+w*c+b*_+g*m,E=n[8],w=n[9],b=n[10],g=n[11],e[8]=E*r+w*s+b*h+g*v,e[9]=E*i+w*u+b*f+g*p,e[10]=E*a+w*l+b*d+g*y,e[11]=E*o+w*c+b*_+g*m,E=n[12],w=n[13],b=n[14],g=n[15],e[12]=E*r+w*s+b*h+g*v,e[13]=E*i+w*u+b*f+g*p,e[14]=E*a+w*l+b*d+g*y,e[15]=E*o+w*c+b*_+g*m,e}function _(e,t,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],l=t[3],c=t[4],h=t[5],f=t[6],d=t[7],_=t[8],v=t[9],p=t[10],y=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=h,e[6]=f,e[7]=d,e[8]=_,e[9]=v,e[10]=p,e[11]=y,e[12]=o*r+c*i+_*a+t[12],e[13]=s*r+h*i+v*a+t[13],e[14]=u*r+f*i+p*a+t[14],e[15]=l*r+d*i+y*a+t[15]),e}function v(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(e,t,n,r){var i=r[0],a=r[1],o=r[2],s=Math.sqrt(i*i+a*a+o*o),u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0,m=void 0,E=void 0,w=void 0,b=void 0,g=void 0,R=void 0,M=void 0,A=void 0,T=void 0,O=void 0,P=void 0,x=void 0,I=void 0,S=void 0;return Math.abs(s)<K.EPSILON?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(n),l=Math.cos(n),c=1-l,h=t[0],f=t[1],d=t[2],_=t[3],v=t[4],p=t[5],y=t[6],m=t[7],E=t[8],w=t[9],b=t[10],g=t[11],R=i*i*c+l,M=a*i*c+o*u,A=o*i*c-a*u,T=i*a*c-o*u,O=a*a*c+l,P=o*a*c+i*u,x=i*o*c+a*u,I=a*o*c-i*u,S=o*o*c+l,e[0]=h*R+v*M+E*A,e[1]=f*R+p*M+w*A,e[2]=d*R+y*M+b*A,e[3]=_*R+m*M+g*A,e[4]=h*T+v*O+E*P,e[5]=f*T+p*O+w*P,e[6]=d*T+y*O+b*P,e[7]=_*T+m*O+g*P,e[8]=h*x+v*I+E*S,e[9]=f*x+p*I+w*S,e[10]=d*x+y*I+b*S,e[11]=_*x+m*I+g*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function y(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+c*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=l*i-a*r,e[9]=c*i-o*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function m(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*r,e[1]=o*i-c*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=a*r+l*i,e[9]=o*r+c*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function E(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+c*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=l*i-a*r,e[5]=c*i-o*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function w(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function b(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g(e,t,n){var r=n[0],i=n[1],a=n[2],o=Math.sqrt(r*r+i*i+a*a),s=void 0,u=void 0,l=void 0;return Math.abs(o)<K.EPSILON?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(t),u=Math.cos(t),l=1-u,e[0]=r*r*l+u,e[1]=i*r*l+a*s,e[2]=a*r*l-i*s,e[3]=0,e[4]=r*i*l-a*s,e[5]=i*i*l+u,e[6]=a*i*l+r*s,e[7]=0,e[8]=r*a*l+i*s,e[9]=i*a*l-r*s,e[10]=a*a*l+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function R(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function M(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,d=i*u,_=i*l,v=a*l,p=o*s,y=o*u,m=o*l;return e[0]=1-(d+v),e[1]=h+m,e[2]=f-y,e[3]=0,e[4]=h-m,e[5]=1-(c+v),e[6]=_+p,e[7]=0,e[8]=f+y,e[9]=_-p,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function O(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function P(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(u*u+l*l+c*c),e}function x(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function I(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,l=a+a,c=o+o,h=i*u,f=i*l,d=i*c,_=a*l,v=a*c,p=o*c,y=s*u,m=s*l,E=s*c,w=r[0],b=r[1],g=r[2];return e[0]=(1-(_+p))*w,e[1]=(f+E)*w,e[2]=(d-m)*w,e[3]=0,e[4]=(f-E)*b,e[5]=(1-(h+p))*b,e[6]=(v+y)*b,e[7]=0,e[8]=(d+m)*g,e[9]=(v-y)*g,e[10]=(1-(h+_))*g,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function S(e,t,n,r,i){var a=t[0],o=t[1],s=t[2],u=t[3],l=a+a,c=o+o,h=s+s,f=a*l,d=a*c,_=a*h,v=o*c,p=o*h,y=s*h,m=u*l,E=u*c,w=u*h,b=r[0],g=r[1],R=r[2],M=i[0],A=i[1],T=i[2],O=(1-(v+y))*b,P=(d+w)*b,x=(_-E)*b,I=(d-w)*g,S=(1-(f+y))*g,N=(p+m)*g,k=(_+E)*R,C=(p-m)*R,L=(1-(f+v))*R;return e[0]=O,e[1]=P,e[2]=x,e[3]=0,e[4]=I,e[5]=S,e[6]=N,e[7]=0,e[8]=k,e[9]=C,e[10]=L,e[11]=0,e[12]=n[0]+M-(O*M+I*A+k*T),e[13]=n[1]+A-(P*M+S*A+C*T),e[14]=n[2]+T-(x*M+N*A+L*T),e[15]=1,e}function N(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,d=i*s,_=i*u,v=a*o,p=a*s,y=a*u;return e[0]=1-h-_,e[1]=c+y,e[2]=f-p,e[3]=0,e[4]=c-y,e[5]=1-l-_,e[6]=d+v,e[7]=0,e[8]=f+p,e[9]=d-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function k(e,t,n,r,i,a,o){var s=1/(n-t),u=1/(i-r),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e}function C(e,t,n,r,i){var a=1/Math.tan(t/2),o=1/(r-i);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e}function L(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function D(e,t,n,r,i,a,o){var s=1/(t-n),u=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(o+a)*l,e[15]=1,e}function F(e,t,n,r){var i=void 0,a=void 0,o=void 0,s=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=t[0],p=t[1],y=t[2],m=r[0],E=r[1],w=r[2],b=n[0],g=n[1],R=n[2];return Math.abs(v-b)<K.EPSILON&&Math.abs(p-g)<K.EPSILON&&Math.abs(y-R)<K.EPSILON?u(e):(h=v-b,f=p-g,d=y-R,_=1/Math.sqrt(h*h+f*f+d*d),h*=_,f*=_,d*=_,i=E*d-w*f,a=w*h-m*d,o=m*f-E*h,_=Math.sqrt(i*i+a*a+o*o),_?(_=1/_,i*=_,a*=_,o*=_):(i=0,a=0,o=0),s=f*o-d*a,l=d*i-h*o,c=h*a-f*i,_=Math.sqrt(s*s+l*l+c*c),_?(_=1/_,s*=_,l*=_,c*=_):(s=0,l=0,c=0),e[0]=i,e[1]=s,e[2]=h,e[3]=0,e[4]=a,e[5]=l,e[6]=f,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(i*v+a*p+o*y),e[13]=-(s*v+l*p+c*y),e[14]=-(h*v+f*p+d*y),e[15]=1,e)}function V(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=a-n[1],f=o-n[2],d=c*c+h*h+f*f;d>0&&(d=1/Math.sqrt(d),c*=d,h*=d,f*=d);var _=u*f-l*h,v=l*c-s*f,p=s*h-u*c;return d=_*_+v*v+p*p,d>0&&(d=1/Math.sqrt(d),_*=d,v*=d,p*=d),e[0]=_,e[1]=v,e[2]=p,e[3]=0,e[4]=h*p-f*v,e[5]=f*_-c*p,e[6]=c*v-h*_,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function X(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function W(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function j(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function H(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function G(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function U(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Y(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function z(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],p=e[14],y=e[15],m=t[0],E=t[1],w=t[2],b=t[3],g=t[4],R=t[5],M=t[6],A=t[7],T=t[8],O=t[9],P=t[10],x=t[11],I=t[12],S=t[13],N=t[14],k=t[15];return Math.abs(n-m)<=K.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-E)<=K.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(i-w)<=K.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-b)<=K.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-g)<=K.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(s-R)<=K.EPSILON*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(u-M)<=K.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(l-A)<=K.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-T)<=K.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-O)<=K.EPSILON*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(f-P)<=K.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(d-x)<=K.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(_-I)<=K.EPSILON*Math.max(1,Math.abs(_),Math.abs(I))&&Math.abs(v-S)<=K.EPSILON*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(p-N)<=K.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(y-k)<=K.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=r,t.clone=i,t.copy=a,t.fromValues=o,t.set=s,t.identity=u,t.transpose=l,t.invert=c,t.adjoint=h,t.determinant=f,t.multiply=d,t.translate=_,t.scale=v,t.rotate=p,t.rotateX=y,t.rotateY=m,t.rotateZ=E,t.fromTranslation=w,t.fromScaling=b,t.fromRotation=g,t.fromXRotation=R,t.fromYRotation=M,t.fromZRotation=A,t.fromRotationTranslation=T,t.getTranslation=O,t.getScaling=P,t.getRotation=x,t.fromRotationTranslationScale=I,t.fromRotationTranslationScaleOrigin=S,t.fromQuat=N,t.frustum=k,t.perspective=C,t.perspectiveFromFieldOfView=L,t.ortho=D,t.lookAt=F,t.targetTo=V,t.str=X,t.frob=W,t.add=j,t.subtract=H,t.multiplyScalar=G,t.multiplyScalarAndAdd=U,t.exactEquals=Y,t.equals=z;var B=n(4),K=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(B);t.mul=d,t.sub=H},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(){var e=new w.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function o(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function s(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return 0!=r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function u(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],u=n[1],l=n[2],c=n[3];return e[0]=r*c+o*s+i*l-a*u,e[1]=i*c+o*u+a*s-r*l,e[2]=a*c+o*l+r*u-i*s,e[3]=o*c-r*s-i*u-a*l,e}function l(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=a*u-i*s,e[3]=o*u-r*s,e}function c(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-a*s,e[1]=i*u+o*s,e[2]=a*u+r*s,e[3]=o*u-i*s,e}function h(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=i*u-r*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e}function f(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function d(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=n[0],l=n[1],c=n[2],h=n[3],f=void 0,d=void 0,_=void 0,v=void 0,p=void 0;return d=i*u+a*l+o*c+s*h,d<0&&(d=-d,u=-u,l=-l,c=-c,h=-h),1-d>1e-6?(f=Math.acos(d),_=Math.sin(f),v=Math.sin((1-r)*f)/_,p=Math.sin(r*f)/_):(v=1-r,p=r),e[0]=v*i+p*u,e[1]=v*a+p*l,e[2]=v*o+p*c,e[3]=v*s+p*h,e}function _(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=a*s,e}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function p(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*a+o]-t[3*o+a])*r,e[a]=(t[3*a+i]+t[3*i+a])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e}function y(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return e[0]=a*u*c-o*s*l,e[1]=o*s*c+a*u*l,e[2]=o*u*l-a*s*c,e[3]=o*u*c+a*s*l,e}function m(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=i,t.identity=a,t.setAxisAngle=o,t.getAxisAngle=s,t.multiply=u,t.rotateX=l,t.rotateY=c,t.rotateZ=h,t.calculateW=f,t.slerp=d,t.invert=_,t.conjugate=v,t.fromMat3=p,t.fromEuler=y,t.str=m;var E=n(4),w=r(E),b=n(27),g=r(b),R=n(12),M=r(R),A=n(28),T=r(A),O=(t.clone=T.clone,t.fromValues=T.fromValues,t.copy=T.copy,t.set=T.set,t.add=T.add,t.mul=u,t.scale=T.scale,t.dot=T.dot,t.lerp=T.lerp,t.length=T.length),P=(t.len=O,t.squaredLength=T.squaredLength),x=(t.sqrLen=P,t.normalize=T.normalize);t.exactEquals=T.exactEquals,t.equals=T.equals,t.rotationTo=function(){var e=M.create(),t=M.fromValues(1,0,0),n=M.fromValues(0,1,0);return function(r,i,a){var s=M.dot(i,a);return s<-.999999?(M.cross(e,t,i),M.len(e)<1e-6&&M.cross(e,n,i),M.normalize(e,e),o(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(M.cross(e,i,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,x(r,r))}}(),t.sqlerp=function(){var e=i(),t=i();return function(n,r,i,a,o,s){return d(e,r,o,s),d(t,i,a,s),d(n,e,t,2*s*(1-s)),n}}(),t.setAxes=function(){var e=g.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],x(t,p(t,e))}}()},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"decodeLength",value:function(e){return e.length/4*3}},{key:"decodeArrayBuffer",value:function(e,t){var n=e.length/4*3;return t&&t.byteLength==n||(t=new ArrayBuffer(n)),this.decode(e,t),t}},{key:"removePaddingChars",value:function(e){return 64==this._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e}},{key:"decode",value:function(e,t){e=this.removePaddingChars(e),e=this.removePaddingChars(e);var n,r,i,a,o,s,u,l,c=parseInt(e.length/4*3,10),h=0,f=0;for(n=t?new Uint8Array(t):new Uint8Array(c),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),h=0;h<c;h+=3)o=this._keyStr.indexOf(e.charAt(f++)),s=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),l=this._keyStr.indexOf(e.charAt(f++)),r=o<<2|s>>4,i=(15&s)<<4|u>>2,a=(3&u)<<6|l,n[h]=r,64!=u&&(n[h+1]=i),64!=l&&(n[h+2]=a);return n}},{key:"encode",value:function(e){var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=e;e instanceof ArrayBuffer?r=new Uint8Array(arrayBuffer):e instanceof ImageData&&(r=e.data);for(var i,a,o,s,u,l=e.length,c=l%3,h=l-c,f=0;f<h;f+=3)u=r[f]<<16|r[f+1]<<8|r[f+2],i=(16515072&u)>>18,a=(258048&u)>>12,o=(4032&u)>>6,s=63&u,t+=n[i]+n[a]+n[o]+n[s];return 1==c?(u=r[h],i=(252&u)>>2,a=(3&u)<<4,t+=n[i]+n[a]+"=="):2==c&&(u=r[h]<<8|r[h+1],i=(64512&u)>>10,a=(1008&u)>>4,o=(15&u)<<2,t+=n[i]+n[a]+n[o]+"="),t}}]),e}();t.default=a,a._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._ambientLightIntensity=1}return i(e,[{key:"getAmbientColorTemperature",value:function(){throw new Error("Not implemented")}},{key:"ambientIntensity",set:function(e){this._ambientLightIntensity=e/1e3},get:function(){return this._ambientLightIntensity}}]),e}();t.default=a},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),s=r(o),u=n(2),l=r(u),c=n(1),h=(r(c),function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,e),this._anchorUID=t,this._tempArray=new Float32Array(16),this._poseMatrix=n||s.default.mat4_generateIdentity()}return a(e,[{key:"setIdentityOffset",value:function(){var e=this._poseMatrix;e[0]=e[5]=e[10]=e[15]=1,e[1]=e[2]=e[3]=0,e[4]=e[6]=e[7]=0,e[8]=e[9]=e[11]=0,e[12]=e[13]=e[14]=0}},{key:"getOffsetTransform",value:function(e){return s.default.mat4_multiply(this._tempArray,this._poseMatrix,e._poseModelMatrix)}},{key:"anchorUID",get:function(){return this._anchorUID}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(e){for(var t=0;t<16;t++)this._poseMatrix[t]=e[t]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseMatrix),e.toArray()}}]),e}());t.default=h},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,i,a){r(this,e),this._x=t,this._y=n,this._width=i,this._height=a}return i(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),e}();t.default=a},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(u.default);t.default=l},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(3),c=i(l),h=n(15),f=i(h),d=n(2),_=i(d),v=n(38),p=i(v),y=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._deviceOrientation=null,e._windowOrientation=0,window.addEventListener("orientationchange",function(){e._windowOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(n){e._deviceOrientation=n;try{e.dispatchEvent(new CustomEvent(t.ORIENTATION_UPDATE_EVENT,{deviceOrientation:e._deviceOrientation,windowOrientation:e._windowOrientation}))}catch(e){console.error("deviceorientation event handler error",e)}},!1),e}return s(t,e),u(t,[{key:"getOrientation",value:function(e){return null===this._deviceOrientation?(e.set(0,0,0,1),!1):(t.WORKING_EULER.set(this._deviceOrientation.beta*t.DEG_TO_RAD,this._deviceOrientation.alpha*t.DEG_TO_RAD,-1*this._deviceOrientation.gamma*t.DEG_TO_RAD,"YXZ"),e.setFromEuler(t.WORKING_EULER.x,t.WORKING_EULER.y,t.WORKING_EULER.z,t.WORKING_EULER.order),e.multiply(t.HALF_PI_AROUND_X),e.multiply(t.WORKING_QUATERNION.setFromAxisAngle(t.Z_AXIS,-this._windowOrientation*t.DEG_TO_RAD)),!0)}}]),t}(c.default);t.default=y,y.ORIENTATION_UPDATE_EVENT="orientation-update",y.Z_AXIS=new f.default(0,0,1),y.WORKING_EULER=new p.default,y.WORKING_QUATERNION=new _.default,y.HALF_PI_AROUND_X=new _.default(-Math.sqrt(.5),0,0,Math.sqrt(.5)),y.DEG_TO_RAD=Math.PI/180},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(6),c=i(l),h=n(11),f=i(h),d=n(29),_=i(d),v=n(7),p=i(v),y=n(30),m=i(y),E=n(20),w=i(E),b=n(1),g=i(b),R=n(10),M=i(R),A=n(8),T=i(A),O=n(9),P=i(O),x=n(21),I=i(x),S=n(31),N=i(S),k=n(32),C=i(k),L=n(33),D=i(L),F=n(13),V=i(F),X=n(22),W=i(X),j=n(34),H=i(j),G=n(14),U=i(G),Y=n(23),z=i(Y),B=n(35),K=i(B),q=n(36),Z=i(q),Q=n(3),J=i(Q),$=n(37),ee=i($),te=n(39),ne=i(te),re=n(40),ie=i(re),ae=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));window.XRDisplay=c.default,window.XRSession=f.default,window.XRSessionCreateParameters=_.default,window.Reality=p.default,window.XRPointCloud=m.default,window.XRLightEstimate=w.default,window.XRAnchor=g.default,window.XRPlaneAnchor=M.default,window.XRFaceAnchor=T.default,window.XRImageAnchor=P.default,window.XRAnchorOffset=I.default,window.XRStageBounds=N.default,window.XRStageBoundsPoint=C.default,window.XRPresentationFrame=D.default,window.XRView=V.default,window.XRViewport=W.default,window.XRCoordinateSystem=H.default,window.XRViewPose=U.default,window.XRLayer=z.default,window.XRWebGLLayer=K.default,window.XRVideoFrame=Z.default,XRDisplay=window.XRDisplay,XRSession=window.XRSession,XRSessionCreateParameters=window.XRSessionCreateParameters,Reality=window.Reality,XRPointCloud=window.XRPointCloud,XRLightEstimate=window.XRLightEstimate,XRAnchor=window.XRAnchor,XRPlaneAnchor=window.XRPlaneAnchor,XRFaceAnchor=window.XRFaceAnchor,XRImageAnchor=window.XRImageAnchor,XRAnchorOffset=window.XRAnchorOffset,XRStageBounds=window.XRStageBounds,XRStageBoundsPoint=window.XRStageBoundsPoint,XRPresentationFrame=window.XRPresentationFrame,XRView=window.XRView,XRViewport=window.XRViewport,XRCoordinateSystem=window.XRCoordinateSystem,XRViewPose=window.XRViewPose,XRLayer=window.XRLayer,XRWebGLLayer=window.XRWebGLLayer,XRVideoFrame=window.XRVideoFrame,e._getVRDisplaysFinished=!1,e._sharedRealities=[new ie.default(e)],e._privateRealities=[],e._displays=[new ee.default(e,e._sharedRealities[0])],"function"==typeof navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;null!==s&&(s.capabilities.canPresent&&e._displays.push(new ne.default(e,e._sharedRealities[0],s)))}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}e._getVRDisplaysFinished=!0}):e._getVRDisplaysFinished=!0,e._sessionEls=document.createElement("div"),e._sessionEls.setAttribute("class","webxr-sessions"),e._realityEls=document.createElement("div"),e._realityEls.setAttribute("class","webxr-realities");for(var n=[e._sessionEls,e._realityEls],r=0;r<n.length;r++){var i=n[r];i.style.position="absolute",i.style.width="100%",i.style.height="100%"}var s=function(){document.body.style.width="100%",document.body.style.height="100%",document.body.prepend(e._sessionEls),document.body.prepend(e._realityEls)};return"loading"!==document.readyState?s():document.addEventListener("DOMContentLoaded",s),e}return s(t,e),u(t,[{key:"getDisplays",value:function(){var e=this,t=function t(n){e._getVRDisplaysFinished?n(e._displays):setTimeout(t.bind(e,n),30)};return new Promise(function(e,n){t(e)})}}]),t}(J.default);void 0===navigator.XR&&(navigator.XR=new ae)},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(7),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Virtual",!1,!1))}return o(t,e),s(t,[{key:"_start",value:function(e){}},{key:"_stop",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){return this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(function(e,t){e(null)})}},{key:"_removeAnchor",value:function(e){this._anchors.delete(e)}},{key:"_hitTestNoAnchor",value:function(e,t,n){return null}},{key:"_getHasLightEstimate",value:function(){return!1}},{key:"_findFloorAnchor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new Float32Array(e._headPose.poseModelMatrix);return new Promise(function(i,a){r[13]=0;var o=new XRCoordinateSystem(e,XRCoordinateSystem.TRACKER);o._relativeMatrix=r;var s=new XRAnchor(o,n);t._addAnchor(s,e),i(new XRAnchorOffset(s.uid))})}},{key:"_getTimeStamp",value:function(e){return e}}]),t}(l.default);t.default=c},function(e,t,n){function r(){var e=new C.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e){var t=new C.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function s(e,t,n,r,i,a,o,s,u){var l=new C.ARRAY_TYPE(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=u,l}function u(e,t,n,r,i,a,o,s,u,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function c(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function h(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*o-s*l,f=-c*a+s*u,d=l*a-o*u,_=n*h+r*f+i*d;return _?(_=1/_,e[0]=h*_,e[1]=(-c*r+i*l)*_,e[2]=(s*r-i*o)*_,e[3]=f*_,e[4]=(c*n-i*u)*_,e[5]=(-s*n+i*a)*_,e[6]=d*_,e[7]=(-l*n+r*u)*_,e[8]=(o*n-r*a)*_,e):null}function f(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=i*l-r*c,e[2]=r*s-i*o,e[3]=s*u-a*c,e[4]=n*c-i*u,e[5]=i*a-n*s,e[6]=a*l-o*u,e[7]=r*u-n*l,e[8]=n*o-r*a,e}function d(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+n*(-l*i+o*s)+r*(u*i-a*s)}function _(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],d=n[1],_=n[2],v=n[3],p=n[4],y=n[5],m=n[6],E=n[7],w=n[8];return e[0]=f*r+d*o+_*l,e[1]=f*i+d*s+_*c,e[2]=f*a+d*u+_*h,e[3]=v*r+p*o+y*l,e[4]=v*i+p*s+y*c,e[5]=v*a+p*u+y*h,e[6]=m*r+E*o+w*l,e[7]=m*i+E*s+w*c,e[8]=m*a+E*u+w*h,e}function v(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=f*r+d*o+l,e[7]=f*i+d*s+c,e[8]=f*a+d*u+h,e}function p(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*r+f*o,e[1]=d*i+f*s,e[2]=d*a+f*u,e[3]=d*o-f*r,e[4]=d*s-f*i,e[5]=d*u-f*a,e[6]=l,e[7]=c,e[8]=h,e}function y(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function E(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function w(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function g(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,d=i*s,_=i*u,v=a*o,p=a*s,y=a*u;return e[0]=1-h-_,e[3]=c-y,e[6]=f+p,e[1]=c+y,e[4]=1-l-_,e[7]=d-v,e[2]=f-p,e[5]=d+v,e[8]=1-l-h,e}function R(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=n*s-r*o,E=n*u-i*o,w=n*l-a*o,b=r*u-i*s,g=r*l-a*s,R=i*l-a*u,M=c*v-h*_,A=c*p-f*_,T=c*y-d*_,O=h*p-f*v,P=h*y-d*v,x=f*y-d*p,I=m*x-E*P+w*O+b*T-g*A+R*M;return I?(I=1/I,e[0]=(s*x-u*P+l*O)*I,e[1]=(u*T-o*x-l*A)*I,e[2]=(o*P-s*T+l*M)*I,e[3]=(i*P-r*x-a*O)*I,e[4]=(n*x-i*T+a*A)*I,e[5]=(r*T-n*P-a*M)*I,e[6]=(v*R-p*g+y*b)*I,e[7]=(p*w-_*R-y*E)*I,e[8]=(_*g-v*w+y*m)*I,e):null}function M(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function A(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function T(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))}function O(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function P(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function x(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function I(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function S(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function N(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=t[0],f=t[1],d=t[2],_=t[3],v=t[4],p=t[5],y=t[6],m=t[7],E=t[8];return Math.abs(n-h)<=C.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=C.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=C.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-_)<=C.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-v)<=C.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-p)<=C.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-y)<=C.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-m)<=C.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-E)<=C.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=r,t.fromMat4=i,t.clone=a,t.copy=o,t.fromValues=s,t.set=u,t.identity=l,t.transpose=c,t.invert=h,t.adjoint=f,t.determinant=d,t.multiply=_,t.translate=v,t.rotate=p,t.scale=y,t.fromTranslation=m,t.fromRotation=E,t.fromScaling=w,t.fromMat2d=b,t.fromQuat=g,t.normalFromMat4=R,t.projection=M,t.str=A,t.frob=T,t.add=O,t.subtract=P,t.multiplyScalar=x,t.multiplyScalarAndAdd=I,t.exactEquals=S,t.equals=N;var k=n(4),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(k);t.mul=_,t.sub=P},function(e,t,n){function r(){var e=new L.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function i(e){var t=new L.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,n,r){var i=new L.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function s(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function u(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function l(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function c(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function h(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function f(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function _(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function v(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function p(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function y(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function m(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function E(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function w(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}function b(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function g(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function R(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function M(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function A(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o),e}function T(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function O(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e[3]=s+r*(n[3]-s),e}function P(e,t){return t=t||1,e[0]=L.RANDOM(),e[1]=L.RANDOM(),e[2]=L.RANDOM(),e[3]=L.RANDOM(),A(e,e),y(e,e,t),e}function x(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}function I(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,f=l*a+o*i-s*r,d=-o*r-s*i-u*a;return e[0]=c*l+d*-o+h*-u-f*-s,e[1]=h*l+d*-s+f*-o-c*-u,e[2]=f*l+d*-u+c*-s-h*-o,e[3]=t[3],e}function S(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function N(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function k(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(n-o)<=L.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=L.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=L.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=L.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=r,t.clone=i,t.fromValues=a,t.copy=o,t.set=s,t.add=u,t.subtract=l,t.multiply=c,t.divide=h,t.ceil=f,t.floor=d,t.min=_,t.max=v,t.round=p,t.scale=y,t.scaleAndAdd=m,t.distance=E,t.squaredDistance=w,t.length=b,t.squaredLength=g,t.negate=R,t.inverse=M,t.normalize=A,t.dot=T,t.lerp=O,t.random=P,t.transformMat4=x,t.transformQuat=I,t.str=S,t.exactEquals=N,t.equals=k;var C=n(4),L=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(C);t.sub=l,t.mul=c,t.div=h,t.dist=E,t.sqrDist=w,t.len=b,t.sqrLen=g,t.forEach=function(){var e=r();return function(t,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}()},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"exclusive",get:function(){throw"Not implemented"}},{key:"type",get:function(){throw"Not implemented"}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"points",get:function(){throw new Error("Not implemented")}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"center",get:function(){throw new Error("Not implemented")}},{key:"geometry",get:function(){throw new Error("Not implemented")}}]),e}();t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"x",get:function(){throw new Error("Not implemented")}},{key:"y",get:function(){throw new Error("Not implemented")}}]),e}();t.default=a},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),s=r(o),u=n(5),l=r(u),c=n(0),h=r(c),f=function(){function e(t,n){i(this,e),this._session=t,this._timestamp=this._session.reality._getTimeStamp(n)}return a(e,[{key:"addAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1],r=h.default.mat4_fromRotationTranslation(new Float32Array(16),n,t);h.default.mat4_multiply(r,e.getTransformTo(this._session._display._trackerCoordinateSystem),r);var i=new XRCoordinateSystem(this._session._display,XRCoordinateSystem.TRACKER);return i._relativeMatrix=r,this._session.reality._addAnchor(new s.default(i),this._session.display)}},{key:"findAnchor",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._session.reality._findAnchor(e,t,this._session.display,n)}},{key:"hitTestNoAnchor",value:function(e,t){return this._session.reality._hitTestNoAnchor(e,t,this._session.display)}},{key:"findFloorAnchor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._session.reality._findFloorAnchor(this._session.display,e)}},{key:"removeAnchor",value:function(e){return this._session.reality._removeAnchor(e)}},{key:"getAnchor",value:function(e){return this._session.reality._getAnchor(e)}},{key:"getCoordinateSystem",value:function(){var e;return(e=this._session)._getCoordinateSystem.apply(e,arguments)}},{key:"getDisplayPose",value:function(e){switch(e._type){case XRCoordinateSystem.HEAD_MODEL:return this._session._display._headPose;case XRCoordinateSystem.EYE_LEVEL:return this._session._display._eyeLevelPose;default:return null}}},{key:"session",get:function(){return this._session}},{key:"views",get:function(){return this._session._display._views}},{key:"hasPointCloud",get:function(){return!1}},{key:"pointCloud",get:function(){return null}},{key:"hasLightEstimate",get:function(){return this._session.reality._getHasLightEstimate()}},{key:"lightEstimate",get:function(){return this._session.reality._getLightAmbientIntensity()}},{key:"timestamp",get:function(){return this._timestamp}},{key:"anchors",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=this._session.reality._anchors.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.push(o)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return e}}]),e}();t.default=f,f.HIT_TEST_TYPE_FEATURE_POINT=l.default.HIT_TEST_TYPE_FEATURE_POINT,f.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=l.default.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE,f.HIT_TEST_TYPE_ESTIMATED_VERTICAL_PLANE=l.default.HIT_TEST_TYPE_ESTIMATED_VERTICAL_PLANE,f.HIT_TEST_TYPE_EXISTING_PLANE=l.default.HIT_TEST_TYPE_EXISTING_PLANE,f.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=l.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,f.HIT_TEST_TYPE_EXISTING_PLANE_USING_GEOMETRY=l.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_GEOMETRY,f.HIT_TEST_TYPE_ALL=l.default.HIT_TEST_TYPE_FEATURE_POINT|l.default.HIT_TEST_TYPE_EXISTING_PLANE|l.default.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|l.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,f.HIT_TEST_TYPE_EXISTING_PLANES=l.default.HIT_TEST_TYPE_EXISTING_PLANE|l.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n){r(this,e),this._display=t,this._type=n,this.__relativeMatrix=o.default.mat4_generateIdentity(),this._workingMatrix=o.default.mat4_generateIdentity()}return i(e,[{key:"getTransformTo",value:function(e){var t=o.default.mat4_invert(new Float32Array(16),e._poseModelMatrix),n=o.default.mat4_generateIdentity();return o.default.mat4_multiply(n,t,n),o.default.mat4_multiply(n,this._poseModelMatrix,n),n}},{key:"_relativeMatrix",get:function(){return this.__relativeMatrix},set:function(e){for(var t=0;t<16;t++)this.__relativeMatrix[t]=e[t]}},{key:"_poseModelMatrix",get:function(){switch(this._type){case e.HEAD_MODEL:return this._display._headPose.poseModelMatrix;case e.EYE_LEVEL:return this._display._eyeLevelPose.poseModelMatrix;case e.TRACKER:return o.default.mat4_multiply(this._workingMatrix,this.__relativeMatrix,this._display._trackerPoseModelMatrix),this._workingMatrix;default:throw new Error("Unknown coordinate system type: "+this._type)}}}]),e}();t.default=s,s.HEAD_MODEL="headModel",s.EYE_LEVEL="eyeLevel",s.TRACKER="tracker",s.TYPES=[s.HEAD_MODEL,s.EYE_LEVEL,s.TRACKER]},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(23),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._session=e,r._context=n,r._width=r._context.canvas.width,r._height=r._context.canvas.height,r._framebuffer=null,r}return o(t,e),s(t,[{key:"requestViewportScaling",value:function(e){throw"Not implemented"}},{key:"context",get:function(){return this._context}},{key:"antialias",get:function(){throw"Not implemented"}},{key:"depth",get:function(){throw"Not implemented"}},{key:"stencil",get:function(){throw"Not implemented"}},{key:"alpha",get:function(){throw"Not implemented"}},{key:"multiview",get:function(){throw"Not implemented"}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"framebufferWidth",set:function(e){this._width=e,this._context.canvas.width=e},get:function(){return this._width}},{key:"framebufferHeight",set:function(e){this._height=e,this._context.canvas.height=e},get:function(){return this._height}}]),t}(l.default);t.default=c},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4),s=(r(o),n(17)),u=(r(s),n(18)),l=(r(u),n(12)),c=(r(l),n(19)),h=function(e){return e&&e.__esModule?e:{default:e}}(c),f=[],d=function(){function e(t,n,r,a){i(this,e),this._buffers=t;for(var o=0;o<t.length;o++)if(t[o]._buffer=t[o].buffer,t[o].buffer=null,t[o]._abCache||"string"!=typeof t[o]._buffer){if(!t[o]._abCache&&t[o]._buffer instanceof ImageData){for(var s=t[o]._buffer.data,u=s.length,l=0;l<f.length;l++)if(f[l].byteLength==u){t[o]._abCache=f[l],f.splice(l,1);break}var c=t[o]._abCache?t[o]._abCache:new ArrayBuffer(u);t[o]._abCache=null;for(var d=new Uint8Array(c),_=0;_<u;_++)d[_]=s[_];t[o]._buffer=c}}else for(var u=h.default.decodeLength(t[o]._buffer),l=0;l<f.length;l++)if(f[l].byteLength==u){t[o]._abCache=f[l],f.splice(l,1);break}this._pixelFormat=n,this._timestamp=r,this._camera=a}return a(e,[{key:"numBuffers",value:function(){this._buffers.length}},{key:"buffer",value:function(e){if(e>=0&&e<this._buffers.length){var t=this._buffers[e];return t.buffer||("string"==typeof t._buffer?(t._buffer=h.default.decodeArrayBuffer(t._buffer,t._abCache),t._abCache=null,t.buffer=new Uint8Array(t._buffer)):t._buffer instanceof ArrayBuffer?t.buffer=new Uint8Array(t._buffer):t._buffer instanceof ImageData&&(t.buffer=ImageData.data)),t}return null}},{key:"release",value:function(){for(var e=this._buffers,t=0;t<e.length;t++)e[t]._buffer instanceof ArrayBuffer&&e[t]._buffer.byteLength>0&&f.push(e[t]._buffer),e[t]._abCache instanceof ArrayBuffer&&e[t]._abCache.byteLength>0&&f.push(e[t]._abCache)}},{key:"postMessageToWorker",value:function(e,t){var n=Object.assign({},t||{});n.buffers=this._buffers,n.timestamp=this._timestamp,n.pixelFormat=this._pixelFormat,n.camera=this._camera;for(var r=[],i=0;i<n.buffers.length;i++)n.buffers[i].buffer=n.buffers[i]._buffer,(n.buffers[i]._buffer instanceof ArrayBuffer||n.buffers[i]._buffer instanceof ImageData)&&r.push(n.buffers[i]._buffer),n.buffers[i]._buffer=null,n.buffers[i]._abCache instanceof ArrayBuffer&&r.push(n.buffers[i]._abCache);e.postMessage(n,r)}},{key:"postReplyMessage",value:function(e){var t=Object.assign({},e);t.buffers=this._buffers,t.timestamp=this._timestamp,t.pixelFormat=this._pixelFormat,t.camera=this._camera;for(var n=[],r=0;r<t.buffers.length;r++)t.buffers[r].buffer=null,(t.buffers[r]._buffer instanceof ArrayBuffer||t.buffers[r]._buffer instanceof ImageData)&&(n.push(t.buffers[r]._buffer),t.buffers[r].buffer=t.buffers[r]._buffer),t.buffers[r]._buffer=null,t.buffers[r]._abCache instanceof ArrayBuffer&&n.push(t.buffers[r]._abCache);postMessage(t,n)}},{key:"pixelFormat",get:function(){return this._pixelFormat}},{key:"timestamp",get:function(){return this._timestamp}},{key:"camera",get:function(){return this._camera}}],[{key:"createFromMessage",value:function(e){return new this(e.data.buffers,e.data.pixelFormat,e.data.timestamp,e.data.camera)}}]),e}();t.default=d,d.IMAGEFORMAT_RGBA32="RGBA32",d.IMAGEFORMAT_BGRA32="BGRA32",d.IMAGEFORMAT_RGB24="RGB24",d.IMAGEFORMAT_BGR24="BGR24",d.IMAGEFORMAT_GRAY8="GRAY8",d.IMAGEFORMAT_YUV444P="YUV444P",d.IMAGEFORMAT_YUV422P="YUV422P",d.IMAGEFORMAT_YUV420P="YUV420P",d.IMAGEFORMAT_YUV420SP_NV12="YUV420SP_NV12",d.IMAGEFORMAT_YUV420SP_NV21="YUV420SP_NV21",d.IMAGEFORMAT_HSV="HSV",d.IMAGEFORMAT_Lab="Lab",d.IMAGEFORMAT_DEPTH="DEPTH",d.IMAGEFORMAT_NULL="",d.IMAGEFORMAT=[d.IMAGEFORMAT_RGBA32,d.IMAGEFORMAT_BGRA32,d.IMAGEFORMAT_RGB24,d.IMAGEFORMAT_BGR24,d.IMAGEFORMAT_GRAY8,d.IMAGEFORMAT_YUV444P,d.IMAGEFORMAT_YUV422P,d.IMAGEFORMAT_YUV420P,d.IMAGEFORMAT_YUV420SP_NV12,d.IMAGEFORMAT_YUV420SP_NV21,d.IMAGEFORMAT_HSV,d.IMAGEFORMAT_Lab,d.IMAGEFORMAT_DEPTH,d.IMAGEFORMAT_NULL]},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},h=n(6),f=i(h),d=n(13),_=i(d),v=n(11),p=i(v),y=n(16),m=i(y),E=n(0),w=i(E),b=n(2),g=i(b),R=n(15),M=i(R),A=n(24),T=i(A),O=n(5),P=i(O),x=n(10),I=i(x),S=n(8),N=i(S),k=n(1),C=i(k),L=n(9),D=i(L),F=function(e){function t(e,n){o(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Flat",!1,n));return r._started=!1,r._initialized=!1,r._arKitWrapper=null,r._vrFrameData=null,r._deviceOrientationTracker=null,r._deviceOrientation=null,r._devicePosition=null,r._deviceWorldMatrix=null,r._views.push(new _.default(r._fov,r._depthNear,r._depthFar)),r}return u(t,e),l(t,[{key:"_start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._reality._vrDisplay?null===this._vrFrameData&&(this._vrFrameData=new VRFrameData,this._views[0]._depthNear=this._reality._vrDisplay.depthNear,this._views[0]._depthFar=this._reality._vrDisplay.depthFar,this._deviceOrientation=new g.default,this._devicePosition=new M.default,this._deviceWorldMatrix=new Float32Array(16)):P.default.HasARKit()?!1===this._initialized&&(this._initialized=!0,this._arKitWrapper=P.default.GetOrCreate(),this._arKitWrapper.addEventListener(P.default.INIT_EVENT,this._handleARKitInit.bind(this)),this._arKitWrapper.addEventListener(P.default.WATCH_EVENT,this._handleARKitUpdate.bind(this)),this._arKitWrapper.addEventListener(P.default.WINDOW_RESIZE_EVENT,this._handleARKitWindowResize.bind(this)),this._arKitWrapper.addEventListener(P.default.ON_ERROR,this._handleOnError.bind(this)),this._arKitWrapper.addEventListener(P.default.AR_TRACKING_CHANGED,this._handleArTrackingChanged.bind(this)),this._arKitWrapper.addEventListener(P.default.COMPUTER_VISION_DATA,this._handleComputerVisionData.bind(this)),this._reality.addEventListener(Reality.NEW_WORLD_ANCHOR,this._handleNewWorldAnchor.bind(this)),this._reality.addEventListener(Reality.UPDATE_WORLD_ANCHOR,this._handleUpdateWorldAnchor.bind(this)),this._reality.addEventListener(Reality.REMOVE_WORLD_ANCHOR,this._handleRemoveWorldAnchor.bind(this)),this._arKitWrapper.waitForInit().then(function(){})):!1===this._initialized&&(this._initialized=!0,this._deviceOrientation=new g.default,this._devicePosition=new M.default,this._deviceWorldMatrix=new Float32Array(16),this._deviceOrientationTracker=new T.default,this._deviceOrientationTracker.addEventListener(T.default.ORIENTATION_UPDATE_EVENT,this._updateFromDeviceOrientationTracker.bind(this)),this._reality.addEventListener(Reality.COMPUTER_VISION_DATA,this._handleComputerVisionData.bind(this)),this._reality.addEventListener(Reality.WINDOW_RESIZE_EVENT,this._handleWindowResize.bind(this))),this.running=!0,this._reality._start(e)}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_fixFov",value:function(e,t,n){if(this.baseLayer){n/=e/this.baseLayer._context.canvas.clientWidth;var r=.5*this.baseLayer._context.canvas.clientWidth/n,i=180/Math.PI*2*Math.atan(r),a=.5*this.baseLayer._context.canvas.clientHeight/n,o=180/Math.PI*2*Math.atan(a);this._fov=new m.default(o/2,o/2,i/2,i/2),this._views[0].fov=this._fov}}},{key:"_handleWindowResize",value:function(e){this._fixFov(e.detail.width,e.detail.height,e.detail.focalLength)}},{key:"_handleNewWorldAnchor",value:function(e){var t=e.detail,n=new XRCoordinateSystem(this,XRCoordinateSystem.TRACKER);n._relativeMatrix=t.transform;var r=void 0;switch(t.type){case P.default.ANCHOR_TYPE_PLANE:r=new I.default(n,t.uuid,t.plane_center,[t.plane_extent.x,t.plane_extent.z],t.plane_alignment,t.geometry);break;case P.default.ANCHOR_TYPE_FACE:r=new N.default(n,t.uuid,t.geometry,t.blendShapes);break;case P.default.ANCHOR_TYPE_ANCHOR:r=new C.default(n,t.uuid);break;case P.default.ANCHOR_TYPE_IMAGE:r=new D.default(n,t.uuid)}this._reality._anchors.set(t.uuid,r);try{this.dispatchEvent(new CustomEvent(f.default.NEW_WORLD_ANCHOR,{source:this,detail:r}))}catch(e){console.error("NEW_WORLD_ANCHOR event error",e)}}},{key:"_handleUpdateWorldAnchor",value:function(e){var t=e.detail,n=this._reality._anchors.get(t);if(null!==n)try{this.dispatchEvent(new CustomEvent(f.default.UPDATE_WORLD_ANCHOR,{source:this,detail:n}))}catch(e){console.error("UPDATE_WORLD_ANCHOR event error",e)}}},{key:"_handleRemoveWorldAnchor",value:function(e){var t=e.detail,n=this._reality._anchors.get(t);if(null!==n)try{this.dispatchEvent(new CustomEvent(f.default.REMOVE_WORLD_ANCHOR,{source:this,detail:n}))}catch(e){console.error("REMOVE_WORLD_ANCHOR event error",e)}}},{key:"_handleNewBaseLayer",value:function(e){this.baseLayer=e,e._context.canvas.style.width="100%",e._context.canvas.style.height="100%",e.framebufferWidth=this._xr._sessionEls.clientWidth,e.framebufferHeight=this._xr._sessionEls.clientHeight,null===this._arKitWrapper&&window.addEventListener("resize",function(){e.framebufferWidth=e._context.canvas.clientWidth,e.framebufferHeight=e._context.canvas.clientHeight},!1),this._xr._sessionEls.appendChild(e._context.canvas)}},{key:"_handleNewFrame",value:function(e){null!==this._vrFrameData&&this._updateFromVRDevice()}},{key:"_updateFromVRDevice",value:function(){var e,t;this._reality._vrDisplay.getFrameData(this._vrFrameData),this._views[0].setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),(e=this._deviceOrientation).set.apply(e,a(this._vrFrameData.pose.orientation)),(t=this._devicePosition).set.apply(t,a(this._vrFrameData.pose.position)),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),w.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._views[0].setViewMatrix(this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_updateFromDeviceOrientationTracker",value:function(){this._deviceOrientationTracker.getOrientation(this._deviceOrientation),this._devicePosition.set(this._headPose.poseModelMatrix[12],this._headPose.poseModelMatrix[13],this._headPose.poseModelMatrix[14]),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),w.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._views[0].setViewMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_handleARKitUpdate",value:function(){var e=this._arKitWrapper.getData("camera_transform");e?(this._headPose._setPoseModelMatrix(e),this._views[0].setViewMatrix(e),this._headPose._poseModelMatrix[13]+=XRViewPose.SITTING_EYE_HEIGHT,this._eyeLevelPose._position=this._headPose._position):console.log("no camera transform",this._arKitWrapper.rawARData);var t=this._arKitWrapper.getData("projection_camera");t?this._views[0].setProjectionMatrix(t):console.log("no projection camera",this._arKitWrapper.rawARData)}},{key:"_handleARKitInit",value:function(e){}},{key:"_handleARKitWindowResize",value:function(e){this.baseLayer.framebufferWidth=e.detail.width,this.baseLayer.framebufferHeight=e.detail.height}},{key:"_handleOnError",value:function(e){}},{key:"_handleArTrackingChanged",value:function(e){}},{key:"_handleComputerVisionData",value:function(e){try{this.dispatchEvent(new CustomEvent("videoFrame",{source:this,detail:e.detail}))}catch(e){console.error("computer vision callback error",e)}}},{key:"_requestVideoFrame",value:function(){this._arKitWrapper?this._arKitWrapper._requestComputerVisionData():this._reality._requestVideoFrame()}},{key:"_stopVideoFrames",value:function(){this._arKitWrapper?this._arKitWrapper._stopSendingComputerVisionData():this._reality._stopVideoFrames()}},{key:"_startVideoFrames",value:function(){this._arKitWrapper?this._arKitWrapper._startSendingComputerVisionData():this._reality._startVideoFrames()}},{key:"_createSession",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._start(n),P.default.HasARKit()?this._arKitWrapper.waitForInit().then(function(){return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createSession",e).call(e,n)}):c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createSession",this).call(this,n)}},{key:"_supportedCreationParameters",value:function(e){return e.type===p.default.AUGMENTATION&&!1===e.exclusive}}]),t}(f.default);t.default=F},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;r(this,e),this.x=t,this.y=n,this.z=i,this.order=a}return i(e,[{key:"set",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;this.x=t,this.y=n,this.z=r,this.order=i}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),e}();t.default=a,a.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],a.DefaultOrder="XYZ"},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(6),h=i(c),f=n(13),d=i(f),_=n(11),v=i(_),p=n(14),y=(i(p),n(0)),m=i(y),E=n(2),w=i(E),b=n(15),g=i(b),R=n(24),M=(i(R),n(5)),A=(i(M),function(e){function t(e,n,r){o(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r.displayName,r.capabilities.hasExternalDisplay,n));return i._vrDisplay=r,i._vrFrameData=new VRFrameData,i._leftView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.LEFT),i._rightView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.RIGHT),i._views=[i._leftView,i._rightView],i._deviceOrientation=new w.default,i._devicePosition=new g.default,i._deviceWorldMatrix=new Float32Array(16),i}return u(t,e),l(t,[{key:"_requestAnimationFrame",value:function(e){this._vrDisplay.isPresenting?this._vrDisplay.requestAnimationFrame(e):window.requestAnimationFrame(e)}},{key:"_handleNewBaseLayer",value:function(e){var t=this;this._vrDisplay.requestPresent([{source:e._context.canvas}]).then(function(){var n=t._vrDisplay.getEyeParameters("left"),r=t._vrDisplay.getEyeParameters("right");e.framebufferWidth=2*Math.max(n.renderWidth,r.renderWidth),e.framebufferHeight=Math.max(n.renderHeight,r.renderHeight),e._context.canvas.style.position="absolute",e._context.canvas.style.bottom="1px",e._context.canvas.style.right="1px",e._context.canvas.style.width="100%",e._context.canvas.style.height="100%",document.body.appendChild(e._context.canvas)}).catch(function(e){console.error("Unable to init WebVR 1.1 display",e)})}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewFrame",value:function(e){this._vrDisplay.isPresenting&&this._updateFromVRFrameData()}},{key:"_handleAfterFrame",value:function(e){this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame()}},{key:"_supportedCreationParameters",value:function(e){return e.type===v.default.REALITY&&!0===e.exclusive}},{key:"_updateFromVRFrameData",value:function(){if(this._vrDisplay.getFrameData(this._vrFrameData),this._leftView.setViewMatrix(this._vrFrameData.leftViewMatrix),this._rightView.setViewMatrix(this._vrFrameData.rightViewMatrix),this._leftView.setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),this._rightView.setProjectionMatrix(this._vrFrameData.rightProjectionMatrix),this._vrFrameData.pose){if(this._vrFrameData.pose.orientation){var e;(e=this._deviceOrientation).set.apply(e,a(this._vrFrameData.pose.orientation))}if(this._vrFrameData.pose.position){var t;(t=this._devicePosition).set.apply(t,a(this._vrFrameData.pose.position))}m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._vrDisplay.stageParameters&&this._vrDisplay.stageParameters.sittingToStandingTransform&&m.default.mat4_multiply(this._deviceWorldMatrix,this._vrDisplay.stageParameters.sittingToStandingTransform,this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose.position=this._devicePosition.toArray()}}}]),t}(h.default));t.default=A},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(7),c=i(l),h=n(1),f=i(h),d=n(14),_=i(d),v=n(21),p=i(v),y=n(20),m=i(y),E=n(0),w=i(E),b=n(2),g=i(b),R=n(5),M=i(R),A=n(41),T=i(A),O=n(9),P=i(O),x=n(10),I=(i(x),n(8)),S=(i(I),function(e){function t(e){a(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Camera",!0,!0));return n._initialized=!1,n._running=!1,n._cameraFov=70*Math.PI/180,n._focalLength=160/Math.tan(n._cameraFov/2),n._cameraIntrinsics=[n._focalLength,0,0,0,n._focalLength,0,160,120,1],n._arKitWrapper=null,n._mediaStream=null,n._videoEl=null,n._arCoreCameraRenderer=null,n._arCoreCanvas=null,n._elContext=null,n._vrDisplay=null,n._vrFrameData=null,n._sendingVideo=!1,n._videoFramesPaused=!1,n._sendVideoFrame=!1,n._videoProjectionMatrix=w.default.mat4_generateIdentity(),n._videoViewMatrix=w.default.mat4_generateIdentity(),n._lightEstimate=new m.default,"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){var t=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;if(null!==s&&s.capabilities.hasPassThroughCamera){if(n._vrDisplay=s,n._vrFrameData=new VRFrameData,!window.WebARonARKitSetData&&(n._arCoreCanvas=document.createElement("canvas"),n._xr._realityEls.appendChild(n._arCoreCanvas),n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight,n._elContext=n._arCoreCanvas.getContext("webgl"),null===n._elContext))throw"Could not create CameraReality GL context";break}}}catch(e){r=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw i}}}),window.addEventListener("resize",function(){n._arCoreCanvas&&(n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight),n._videoEl&&setTimeout(function(){n._adjustVideoSize()},10)},!1),n}return s(t,e),u(t,[{key:"_setFovy",value:function(e){if(this._cameraFov=e*Math.PI/180,!this._videoEl)return void(this._focalLength=0);this._videoRenderWidth>this._videoRenderHeight?this._focalLength=this._videoRenderWidth/2/Math.tan(this._cameraFov/2):this._focalLength=this._videoRenderHeight/2/Math.tan(this._cameraFov/2),this._cameraIntrinsics=[this._focalLength,0,0,0,this._focalLength,0,this._videoRenderWidth/2,this._videoRenderHeight/2,1]}},{key:"_adjustVideoSize",value:function(){var e=this._videoRenderWidth,t=this._videoRenderHeight,n=e/t,r=this._videoEl.videoWidth,i=this._videoEl.videoHeight;if(r/i!=n){for(;r>512||i>512;)r/=2,i/=2;e=this._videoRenderWidth=r,t=this._videoRenderHeight=i;var n=e/t;this._videoFrameCanvas.width=r,this._videoFrameCanvas.height=i}this._setFovy(this._cameraFov/(Math.PI/180));var a=this._xr._realityEls.clientWidth,o=this._xr._realityEls.clientHeight,s=a/o,u=0,l=0;n>s?(e=t*s,a=o*n,u=-(a-this._xr._realityEls.clientWidth)/2):(t=e/s,o=a/n,l=-(o-this._xr._realityEls.clientHeight)/2),this._videoEl.style.width=a.toFixed(2)+"px",this._videoEl.style.height=o.toFixed(2)+"px",this._videoEl.style.transform="translate("+u.toFixed(2)+"px, "+l.toFixed(2)+"px)";try{this.dispatchEvent(new CustomEvent(c.default.WINDOW_RESIZE_EVENT,{source:this,detail:{width:e,height:t,focalLength:this._focalLength}}))}catch(e){console.error("WINDOW_RESIZE_EVENT error",e)}}},{key:"_handleNewFrame",value:function(e){if(this._vrDisplay&&(this._arCoreCameraRenderer&&this._arCoreCameraRenderer.render(),this._vrDisplay.getFrameData(this._vrFrameData)),this._videoEl&&this._sendVideoFrame&&!this._videoFramesPaused){this._sendVideoFrame=!1;var t=this._videoRenderWidth,n=this._videoRenderHeight;this._videoCtx.drawImage(this._videoEl,0,0,t,n);var r=this._videoCtx.getImageData(0,0,t,n),i=(r.data,r.data.length,[{size:{width:t,height:n,bytesPerRow:4*t,bytesPerPixel:4},buffer:r}]),a=XRVideoFrame.IMAGEFORMAT_RGBA32,o=e.timestamp,s=e.views[0];w.default.mat4_invert(this._videoViewMatrix,s.viewMatrix),this._videoProjectionMatrix.set(s.projectionMatrix);var u={arCamera:!1,cameraOrientation:0,cameraIntrinsics:this._cameraIntrinsics.slice(0),cameraImageResolution:{width:this._videoEl.videoWidth,height:this._videoEl.videoHeight},viewMatrix:this._videoViewMatrix,projectionMatrix:this._videoProjectionMatrix},l=new XRVideoFrame(i,a,o,u);try{this.dispatchEvent(new CustomEvent(c.default.COMPUTER_VISION_DATA,{source:this,detail:l}))}catch(e){console.error("COMPUTER_VISION_DATA event error",e)}}}},{key:"_start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._running||(this._running=!0,null!==this._vrDisplay?(window.WebARonARKitSetData||(this._arCoreCameraRenderer=new T.default(this._vrDisplay,this._elContext)),this._initialized=!0):M.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=M.default.GetOrCreate(),this._arKitWrapper.addEventListener(M.default.WATCH_EVENT,this._handleARKitWatch.bind(this)),this._arKitWrapper.waitForInit().then(function(){e._arKitWrapper.watch(t)})):this._arKitWrapper.watch(t):!1===this._initialized?(this._initialized=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(n){e._videoEl=document.createElement("video"),e._xr._realityEls.appendChild(e._videoEl),e._videoEl.setAttribute("class","camera-reality-video"),e._videoEl.setAttribute("playsinline",!0),e._videoEl.style.width="100%",e._videoEl.style.height="100%",e._videoEl.srcObject=n,e._videoEl.play(),e._setupWebRTC(t)}).catch(function(t){console.error("Could not set up video stream",t),e._initialized=!1,e._running=!1})):this._videoEl&&(this._xr._realityEls.appendChild(this._videoEl),this._videoEl.play(),this._setupWebRTC(t)))}},{key:"_setupWebRTC",value:function(e){var t=this;e.videoFrames&&(this._sendingVideo=!0,this._videoEl.addEventListener("loadedmetadata",function(){for(var e=t._videoEl.videoWidth,n=t._videoEl.videoHeight;e>256||n>256;)e/=2,n/=2;t._videoRenderWidth=e,t._videoRenderHeight=n,t._videoFrameCanvas=document.createElement("canvas"),t._videoFrameCanvas.width=e,t._videoFrameCanvas.height=n,t._videoCtx=t._videoFrameCanvas.getContext("2d"),t._adjustVideoSize(),t._sendVideoFrame=!0}))}},{key:"_requestVideoFrame",value:function(){this._sendVideoFrame=!0}},{key:"_stopVideoFrames",value:function(){this._videoFramesPaused=!0}},{key:"_startVideoFrames",value:function(){this._videoFramesPaused=!1}},{key:"_stop",value:function(){if(!1!==this._running)if(this._running=!1,M.default.HasARKit()){if(null===this._arKitWrapper)return;this._arKitWrapper.stop()}else this._arCoreCanvas?(this._xr._realityEls.removeChild(this._arCoreCanvas),this._arCoreCanvas=null):null!==this._videoEl&&(this._videoEl.pause(),this._xr._realityEls.removeChild(this._videoEl))}},{key:"_handleARKitWatch",value:function(e){if(e.detail&&e.detail.objects){var t=!0,n=!1,r=void 0;try{for(var i,a=e.detail.objects[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this._updateAnchorFromARKitUpdate(o.uuid,o);try{this.dispatchEvent(new CustomEvent(c.default.UPDATE_WORLD_ANCHOR,{source:this,detail:o.uuid}))}catch(e){console.error("UPDATE_WORLD_ANCHOR event error",e)}}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}if(e.detail&&e.detail.removedObjects){var s=!0,u=!1,l=void 0;try{for(var h,f=e.detail.removedObjects[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var d=h.value;try{this.dispatchEvent(new CustomEvent(c.default.REMOVE_WORLD_ANCHOR,{source:this,detail:d}))}catch(e){console.error("REMOVE_WORLD_ANCHOR event error",e)}this._deleteAnchorFromARKitUpdate(d)}}catch(e){u=!0,l=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}}if(e.detail&&e.detail.newObjects){var _=!0,v=!1,p=void 0;try{for(var y,m=e.detail.newObjects[Symbol.iterator]();!(_=(y=m.next()).done);_=!0){var E=y.value;try{this.dispatchEvent(new CustomEvent(c.default.NEW_WORLD_ANCHOR,{source:this,detail:E}))}catch(e){console.error("NEW_WORLD_ANCHOR event error",e)}}}catch(e){v=!0,p=e}finally{try{!_&&m.return&&m.return()}finally{if(v)throw p}}}}},{key:"_deleteAnchorFromARKitUpdate",value:function(e){this._anchors.delete(e)}},{key:"_handleARKitAddObject",value:function(e){this._updateAnchorFromARKitUpdate(e.uuid,e)}},{key:"_updateAnchorFromARKitUpdate",value:function(e,t){var n=this._anchors.get(e)||null;if(null!==n)switch(n.coordinateSystem._relativeMatrix=t.transform,t.type){case M.default.ANCHOR_TYPE_PLANE:n.center=t.plane_center,n.extent=[t.plane_extent.x,t.plane_extent.z],n.alignment=t.plane_alignment,n.geometry=t.geometry;break;case M.default.ANCHOR_TYPE_FACE:t.geometry&&(n.geometry.vertices=t.geometry.vertices),t.blendShapes&&n.updateBlendShapes(t.blendShapes);break;case M.default.ANCHOR_TYPE_ANCHOR:case M.default.ANCHOR_TYPE_IMAGE:}}},{key:"_addAnchor",value:function(e,t){var n=this;return null!==this._arKitWrapper&&this._arKitWrapper.addAnchor(e.uid,e.coordinateSystem._poseModelMatrix).then(function(e){return n._handleARKitAddObject(e)}),this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise(function(a,o){if(null!==r._arKitWrapper)r._arKitWrapper.hitTest(e,t,i||M.default.HIT_TEST_TYPE_EXISTING_PLANES).then(function(e){if(0===e.length)return void a(null);var t=r._pickARKitHit(e);if(t.anchor_transform){t.anchor_transform[13]+=_.default.SITTING_EYE_HEIGHT,t.world_transform[13]+=_.default.SITTING_EYE_HEIGHT;var i=r._getAnchor(t.uuid);if(null===i){var o=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);o._relativeMatrix=t.anchor_transform,i=new f.default(o,t.uuid),r._anchors.set(i.uid,i)}var s=[t.world_transform[12]-t.anchor_transform[12],t.world_transform[13]-t.anchor_transform[13],t.world_transform[14]-t.anchor_transform[14]],u=(new g.default).setFromRotationMatrix(t.world_transform),l=(new g.default).setFromRotationMatrix(t.anchor_transform).inverse(),c=(new g.default).multiplyQuaternions(u,l),h=new p.default(i.uid);h.poseMatrix=w.default.mat4_fromRotationTranslation(new Float32Array(16),c.toArray(),s),a(h)}else{var d=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);d._relativeMatrix=t.world_transform;var v=new f.default(d,t.uuid);r._anchors.set(v.uid,v);var y=new p.default(v.uid);a(y)}});else if(null!==r._vrDisplay){var s=r._vrDisplay.hitTest(e,t);if(0==s.length)return void a(null);s.sort(function(e,t){return e.distance-t.distance});var u=r._getAnchor(s[0].uuid);if(null===u){var l=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);l._relativeMatrix=s[0].modelMatrix,l._relativeMatrix[13]+=_.default.SITTING_EYE_HEIGHT,u=new f.default(l),r._anchors.set(u.uid,u)}a(new p.default(u.uid))}else a(null)})}},{key:"_createImageAnchor",value:function(e,t,n,r,i){return this._arKitWrapper?this._arKitWrapper.createImageAnchor(e,t,n,r,i):null}},{key:"_activateDetectionImage",value:function(e,t){var n=this;return new Promise(function(r,i){n._arKitWrapper?n._arKitWrapper.activateDetectionImage(e).then(function(e){if(!0===e.activated){var a=new XRCoordinateSystem(t,XRCoordinateSystem.TRACKER);a._relativeMatrix=e.imageAnchor.transform;var o=new P.default(a,e.imageAnchor.uuid);n._anchors.set(e.imageAnchor.uuid,o),r(e.imageAnchor.transform)}else i(null!==e.error?e.error:null)}):i("ARKit not supported")})}},{key:"_removeAnchor",value:function(e){this._arKitWrapper?this._arKitWrapper.removeAnchor(e):this._getAnchor(e)&&this._anchors.delete(e)}},{key:"_pickARKitHit",value:function(e){if(0===e.length)return null;var t=null,n=e.filter(function(e){return e.type!=M.default.HIT_TEST_TYPE_FEATURE_POINT}),r=n.filter(function(e){return e.type==M.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT}),i=n.filter(function(e){return e.type==M.default.HIT_TEST_TYPE_EXISTING_PLANE});return r.length?(r=r.sort(function(e,t){return e.distance-t.distance}),t=r[0]):i.length?(i=i.sort(function(e,t){return e.distance-t.distance}),t=i[0]):n.length?(n=n.sort(function(e,t){return e.distance-t.distance}),t=n[0]):t=e[0],t}},{key:"_hitTestNoAnchor",value:function(e,t,n){if(null!==this._arKitWrapper){for(var r=this._arKitWrapper.hitTestNoAnchor(e,t),i=0;i<r.length;i++)r[i].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==r.length?null:r}if(null!==this._vrDisplay){for(var a=this._vrDisplay.hitTest(e,t),o=0;o<a.length;o++)a[o].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==a.length?null:a}return null}},{key:"_getHasLightEstimate",value:function(){return null!==this._arKitWrapper}},{key:"_getLightAmbientIntensity",value:function(){return null!==this._arKitWrapper?(this._lightEstimate.ambientIntensity=this._arKitWrapper.lightIntensity,this._lightEstimate.ambientIntensity):null}},{key:"_getTimeStamp",value:function(e){return null!==this._arKitWrapper?this._arKitWrapper.timestamp:e}},{key:"_findFloorAnchor",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(e,t){e(null)})}}]),t}(c.default));t.default=S},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if("fragment"==n)var r=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=n)return null;var r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error(e.getShaderInfoLog(r)),null)}function a(e,t,n){var r=i(e,t,"vertex"),a=i(e,n,"fragment");if(!a)return null;var o=e.createProgram();return e.attachShader(o,r),e.attachShader(o,a),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||console.error("Could not initialise arview shaders"),o}function o(e,t){var n=0;switch(t){case 90:n=1;break;case 180:n=2;break;case 270:n=3;break;default:n=0}var r=0;switch(e){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var i=r-n;return i<0&&(i+=4),i%4}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u="#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}",l="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",c=function(){function e(t,n){r(this,e),this.vrDisplay=t,this.gl=n,this.passThroughCamera=t.getPassThroughCamera(),this.program=a(n,l,u),n.useProgram(this.program),this.vertexPositionAttribute=n.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=n.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=n.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexPositionBuffer);var i=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(i);n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.textureCoordBuffer);var c=null;if(this.vrDisplay){var h=this.passThroughCamera.width/this.passThroughCamera.textureWidth,f=this.passThroughCamera.height/this.passThroughCamera.textureHeight;c=[[0,0,0,f,h,0,h,f],[h,0,0,0,h,f,0,f],[h,f,h,0,0,f,0,0],[0,f,h,f,0,0,h,0]]}else c=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var d=0;d<c.length;d++)this.f32TextureCoords.push(new Float32Array(c[d]));this.combinedOrientation=o(screen.orientation.angle,this.passThroughCamera.orientation),n.bufferData(n.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],n.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,n.bindBuffer(n.ARRAY_BUFFER,null),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var _=[0,1,2,2,1,3],v=new Uint16Array(_);return n.bufferData(n.ELEMENT_ARRAY_BUFFER,v,n.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.texture=n.createTexture(),n.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return s(e,[{key:"render",value:function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.enableVertexAttribArray(this.vertexPositionAttribute),e.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordBuffer);var t=o(screen.orientation.angle,this.passThroughCamera.orientation);t!==this.combinedOrientation&&(this.combinedOrientation=t,e.bufferData(e.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],e.STATIC_DRAW)),e.enableVertexAttribArray(this.textureCoordAttribute),e.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,this.texture),e.texImage2D(e.TEXTURE_EXTERNAL_OES,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.passThroughCamera),e.uniform1i(this.samplerUniform,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,this.indexBuffer.numItems,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,null),e.disableVertexAttribArray(this.vertexPositionAttribute),e.disableVertexAttribArray(this.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(),h=function(){function e(t,n){r(this,e),this.vrDisplay=t,this.gl=n,this.videoRenderer=new c(t,this.gl),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}return s(e,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){var e=this.gl,t=1*this.width,n=1*this.height;e.viewportWidth!==t&&(e.viewportWidth=t),e.viewportHeight!==n&&(e.viewportHeight=n),this.gl.viewport(0,0,e.viewportWidth,e.viewportHeight),this.videoRenderer.render()}}]),e}();t.default=h}]),XRDisplay=window.XRDisplay,XRSession=window.XRSession,XRSessionCreateParameters=window.XRSessionCreateParameters,Reality=window.Reality,XRPointCloud=window.XRPointCloud,XRLightEstimate=window.XRLightEstimate,XRAnchor=window.XRAnchor,XRPlaneAnchor=window.XRPlaneAnchor,XRFaceAnchor=window.XRFaceAnchor,XRImageAnchor=window.XRImageAnchor,XRAnchorOffset=window.XRAnchorOffset,XRStageBounds=window.XRStageBounds,XRStageBoundsPoint=window.XRStageBoundsPoint,XRPresentationFrame=window.XRPresentationFrame,XRView=window.XRView,XRViewport=window.XRViewport,XRCoordinateSystem=window.XRCoordinateSystem,XRViewPose=window.XRViewPose,XRLayer=window.XRLayer,XRWebGLLayer=window.XRWebGLLayer,XRVideoFrame=window.XRVideoFrame}]);